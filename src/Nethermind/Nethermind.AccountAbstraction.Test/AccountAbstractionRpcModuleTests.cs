//  Copyright (c) 2021 Demerzel Solutions Limited
//  This file is part of the Nethermind library.
// 
//  The Nethermind library is free software: you can redistribute it and/or modify
//  it under the terms of the GNU Lesser General Public License as published by
//  the Free Software Foundation, either version 3 of the License, or
//  (at your option) any later version.
// 
//  The Nethermind library is distributed in the hope that it will be useful,
//  but WITHOUT ANY WARRANTY; without even the implied warranty of
//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
//  GNU Lesser General Public License for more details.
// 
//  You should have received a copy of the GNU Lesser General Public License
//  along with the Nethermind. If not, see <http://www.gnu.org/licenses/>.
// 

using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using DotNetty.Common.Utilities;
using FluentAssertions;
using Nethermind.Abi;
using Nethermind.AccountAbstraction.Data;
using Nethermind.Consensus;
using Nethermind.Core;
using Nethermind.Core.Crypto;
using Nethermind.Core.Eip2930;
using Nethermind.Core.Extensions;
using Nethermind.Core.Test.Builders;
using Nethermind.Crypto;
using Nethermind.Int256;
using Nethermind.JsonRpc;
using Nethermind.JsonRpc.Data;
using Nethermind.JsonRpc.Test.Modules;
using Nethermind.Logging;
using NUnit.Framework;

namespace Nethermind.AccountAbstraction.Test
{
    [TestFixture]
    public partial class AccountAbstractionRpcModuleTests
    {
        public static class Contracts
        {
            public static string SingletonCode = "0x608060405234801561001057600080fd5b50613b6d806100206000396000f3fe6080604052600436106100ab5760003560e01c8063739b895011610064578063739b8950146101cc5780639984521814610209578063c23a5cea14610232578063c34531531461025b578063d71d622014610298578063ec7d10a8146102d5576100b2565b8063062f8ebd146100b757806311cd0b68146100f457806316934fc41461011d57806334881e3d1461015c5780634a1ce599146101995780635a627dbc146101c2576100b2565b366100b257005b600080fd5b3480156100c357600080fd5b506100de60048036038101906100d9919061265c565b610312565b6040516100eb9190612ded565b60405180910390f35b34801561010057600080fd5b5061011b6004803603810190610116919061255c565b61036e565b005b34801561012957600080fd5b50610144600480360381019061013f9190612354565b6104cf565b60405161015393929190612fc6565b60405180910390f35b34801561016857600080fd5b50610183600480360381019061017e91906124a4565b61053d565b6040516101909190612d49565b60405180910390f35b3480156101a557600080fd5b506101c060048036038101906101bb9190612354565b6105a9565b005b6101ca61075d565b005b3480156101d857600080fd5b506101f360048036038101906101ee91906123ae565b6109c9565b6040516102009190612dcb565b60405180910390f35b34801561021557600080fd5b50610230600480360381019061022b91906123fb565b610af3565b005b34801561023e57600080fd5b5061025960048036038101906102549190612381565b610edb565b005b34801561026757600080fd5b50610282600480360381019061027d9190612354565b6110f2565b60405161028f9190612f0d565b60405180910390f35b3480156102a457600080fd5b506102bf60048036038101906102ba91906125b8565b6111f8565b6040516102cc9190612ffd565b60405180910390f35b3480156102e157600080fd5b506102fc60048036038101906102f79190612513565b6113aa565b6040516103099190612ffd565b60405180910390f35b606061032683610321906135db565b61146b565b61034157604051806020016040528060008152509050610368565b600061035584610350906135db565b6114a9565b905061036460008583866114ca565b9150505b92915050565b600047905060005a90506000806103866000876116bc565b9150915060005a8461039891906134b6565b905060003073ffffffffffffffffffffffffffffffffffffffff1663d71d6220898585886040518563ffffffff1660e01b81526004016103db9493929190612f28565b602060405180830381600087803b1580156103f557600080fd5b505af192505050801561042657506040513d601f19601f8201168201806040525081019061042391906126b8565b60015b61045d576000825a8761043991906134b6565b6104439190613398565b905061045560028a868489600061173c565b915050610462565b809150505b600081874761047191906134b6565b61047b9190613398565b90508773ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f193505050501580156104c3573d6000803e3d6000fd5b50505050505050505050565b60006020528060005260406000206000915090508060000160009054906101000a90046dffffffffffffffffffffffffffff169080600001600e9054906101000a90046dffffffffffffffffffffffffffff169080600001601c9054906101000a900463ffffffff16905083565b60008060ff60f81b3085878660405160200161055a929190612d21565b604051602081830303815290604052805190602001206040516020016105839493929190612c90565b6040516020818303038152906040528051906020012090508060001c9150509392505050565b60008060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000209050600081600001601c9054906101000a900463ffffffff1663ffffffff1614610648576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161063f90612e6d565b60405180910390fd5b600061012c4361065891906133ee565b90508082600001601c6101000a81548163ffffffff021916908363ffffffff1602179055508160000160009054906101000a90046dffffffffffffffffffffffffffff1682600001600e6101000a8154816dffffffffffffffffffffffffffff02191690836dffffffffffffffffffffffffffff16021790555060008260000160006101000a8154816dffffffffffffffffffffffffffff02191690836dffffffffffffffffffffffffffff1602179055503373ffffffffffffffffffffffffffffffffffffffff167fab3a43860ac8cdb29929ba1a1f556b4decf9617f4811c190010e1672e55839b182604051610750919061317d565b60405180910390a2505050565b6000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600001600e9054906101000a90046dffffffffffffffffffffffffffff166dffffffffffffffffffffffffffff16346000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160009054906101000a90046dffffffffffffffffffffffffffff166dffffffffffffffffffffffffffff166108409190613398565b61084a9190613398565b6000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160006101000a8154816dffffffffffffffffffffffffffff02191690836dffffffffffffffffffffffffffff16021790555060008060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600001601c6101000a81548163ffffffff021916908363ffffffff1602179055503373ffffffffffffffffffffffffffffffffffffffff167f7c717985ac273e663b7f3050f5b15a4388ff6ed952338954f650e2093e13937f6000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160009054906101000a90046dffffffffffffffffffffffffffff166040516109bf9190612fab565b60405180910390a2565b60608282905067ffffffffffffffff8111156109e8576109e76137c1565b5b604051908082528060200260200182016040528015610a165781602001602082028036833780820191505090505b50905060005b83839050811015610aec57600080858584818110610a3d57610a3c613792565b5b9050602002016020810190610a529190612354565b73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160009054906101000a90046dffffffffffffffffffffffffffff166dffffffffffffffffffffffffffff16828281518110610acd57610acc613792565b5b6020026020010181815250508080610ae4906136a9565b915050610a1c565b5092915050565b6000479050600084849050905060008167ffffffffffffffff811115610b1c57610b1b6137c1565b5b604051908082528060200260200182016040528015610b4a5781602001602082028036833780820191505090505b50905060008267ffffffffffffffff811115610b6957610b686137c1565b5b604051908082528060200260200182016040528015610b975781602001602082028036833780820191505090505b50905060008367ffffffffffffffff811115610bb657610bb56137c1565b5b604051908082528060200260200182016040528015610be45781602001602082028036833780820191505090505b50905060005b84811015610cb55736898983818110610c0657610c05613792565b5b9050602002810190610c1891906131fb565b905060005a905060606000610c2d85856116bc565b878781518110610c4057610c3f613792565b5b6020026020010181945082815250505081905080878681518110610c6757610c66613792565b5b6020026020010181815250505a83610c7f91906134b6565b888681518110610c9257610c91613792565b5b602002602001018181525050505050508080610cad906136a9565b915050610bea565b506000805b89899050811015610e6c5760005a9050368b8b84818110610cde57610cdd613792565b5b9050602002810190610cf091906131fb565b90506000868481518110610d0757610d06613792565b5b60200260200101519050606081905060003073ffffffffffffffffffffffffffffffffffffffff1663d71d622085848d8a81518110610d4957610d48613792565b5b60200260200101518c8b81518110610d6457610d63613792565b5b60200260200101516040518563ffffffff1660e01b8152600401610d8b9493929190612f28565b602060405180830381600087803b158015610da557600080fd5b505af1925050508015610dd657506040513d601f19601f82011682018060405250810190610dd391906126b8565b60015b610e415760008a8781518110610def57610dee613792565b5b60200260200101515a87610e0391906134b6565b610e0d9190613398565b9050610e3960028685848d8c81518110610e2a57610e29613792565b5b6020026020010151600061173c565b915050610e46565b809150505b8087610e529190613398565b965050505050508080610e64906136a9565b915050610cba565b506000818747610e7c91906134b6565b610e869190613398565b90508773ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050158015610ece573d6000803e3d6000fd5b5050505050505050505050565b60008060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000209050600081600001600e9054906101000a90046dffffffffffffffffffffffffffff166dffffffffffffffffffffffffffff1611610f8e576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610f8590612ead565b60405180910390fd5b4381600001601c9054906101000a900463ffffffff1663ffffffff161115610feb576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610fe290612e8d565b60405180910390fd5b600081600001600e9054906101000a90046dffffffffffffffffffffffffffff166dffffffffffffffffffffffffffff169050600082600001600e6101000a8154816dffffffffffffffffffffffffffff02191690836dffffffffffffffffffffffffffff1602179055508273ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f1935050505015801561109c573d6000803e3d6000fd5b503373ffffffffffffffffffffffffffffffffffffffff167fb7c918e0e249f999e965cafeb6c664271b3f4317d296461500e71da39f0cbda384836040516110e5929190612d64565b60405180910390a2505050565b6110fa611f25565b6000808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206040518060600160405290816000820160009054906101000a90046dffffffffffffffffffffffffffff166dffffffffffffffffffffffffffff166dffffffffffffffffffffffffffff16815260200160008201600e9054906101000a90046dffffffffffffffffffffffffffff166dffffffffffffffffffffffffffff166dffffffffffffffffffffffffffff16815260200160008201601c9054906101000a900463ffffffff1663ffffffff1663ffffffff16815250509050919050565b60003073ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461123257600080fd5b60005a905060008088600001602081019061124d9190612354565b73ffffffffffffffffffffffffffffffffffffffff1689608001358a80606001906112789190613198565b604051611286929190612cde565b60006040518083038160008787f1925050503d80600081146112c4576040519150601f19603f3d011682016040523d82523d6000602084013e6112c9565b606091505b5091509150811580156112dd575060008151115b1561131a577f4744f445624b2fc392c793c67e1668a611f72a9cb69867656f9915f2463d69b6816040516113119190612ded565b60405180910390a15b60008261132857600161132b565b60005b90506000875a8661133c91906134b6565b6113469190613398565b905061139a828c8c8c8080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f82011690508083019250505050505050848b8961173c565b9550505050505095945050505050565b60008073ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461141a576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161141190612e4d565b60405180910390fd5b600061142e83611429906135db565b6114a9565b905060006114448461143f906135db565b61146b565b61144e5781611451565b60005b905061145f60008583611a6a565b50809350505050919050565b60008073ffffffffffffffffffffffffffffffffffffffff1682610100015173ffffffffffffffffffffffffffffffffffffffff1614159050919050565b60008160c001516114b983611c66565b6114c39190613428565b9050919050565b60606114d68484611cba565b61152b5784846101000160208101906114ef9190612354565b6040517efa072b00000000000000000000000000000000000000000000000000000000815260040161152292919061310a565b60405180910390fd5b6000828560a0013561153d91906134b6565b9050846101000160208101906115539190612354565b73ffffffffffffffffffffffffffffffffffffffff1663df3e98178287876040518463ffffffff1660e01b815260040161158e929190612f7b565b60006040518083038187803b1580156115a657600080fd5b5086fa935050505080156115dd57506040513d6000823e3d601f19601f820116820180604052508101906115da919061245b565b60015b6116af576115e96137f0565b806308c379a0141561165c57506115fe613a48565b80611609575061165e565b868661010001602081019061161e9190612354565b826040517efa072b00000000000000000000000000000000000000000000000000000000815260040161165393929190613018565b60405180910390fd5b505b85856101000160208101906116739190612354565b6040517efa072b0000000000000000000000000000000000000000000000000000000081526004016116a69291906130ce565b60405180910390fd5b8092505050949350505050565b600060606116c983611cf4565b60006116dd846116d8906135db565b61146b565b905060006116f3856116ee906135db565b6114a9565b90506000826117025781611705565b60005b90506000611714888884611a6a565b809250819750505083156117315761172e888885846114ca565b94505b505050509250929050565b60008061174887611e64565b905060005a90506000828761175d9190613428565b90506117718961176c906135db565b61146b565b6117d557600089600001602081019061178a9190612354565b73ffffffffffffffffffffffffffffffffffffffff166108fc83896117af91906134b6565b9081150290604051600060405180830381858888f19350505050905060009450506119cf565b6000885111156118f857886101000160208101906117f39190612354565b73ffffffffffffffffffffffffffffffffffffffff1663a9a234098b8a846040518463ffffffff1660e01b815260040161182f93929190612e0f565b600060405180830381600087803b15801561184957600080fd5b505af192505050801561185a575060015b6118f6573d806000811461188a576040519150601f19603f3d011682016040523d82523d6000602084013e61188f565b606091505b507f5f6032b8e84e218db7c512ea2e55828c412cfcba5d42b23d21b42f7e7210b8648a6101000160208101906118c59190612354565b8b60000160208101906118d89190612354565b836040516118e893929190612d8d565b60405180910390a1506118f7565b5b5b825a8361190591906134b6565b61190f9190613428565b8161191a9190613398565b9050806000808b6101000160208101906119349190612354565b73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160008282829054906101000a90046dffffffffffffffffffffffffffff166119999190613482565b92506101000a8154816dffffffffffffffffffffffffffff02191690836dffffffffffffffffffffffffffff1602179055508093505b886101000160208101906119e39190612354565b73ffffffffffffffffffffffffffffffffffffffff16896000016020810190611a0c9190612354565b73ffffffffffffffffffffffffffffffffffffffff167f87ff8671dda0b81e2f2bec38f9ee39fa8b7c73fa15723e01ea0e39a385981e8f838689604051611a5593929190613146565b60405180910390a35050509695505050505050565b60008060005a90506000479050856000016020810190611a8a9190612354565b73ffffffffffffffffffffffffffffffffffffffff16633a0d58d18760a0013588886040518463ffffffff1660e01b8152600401611ac9929190612f7b565b600060405180830381600088803b158015611ae357600080fd5b5087f193505050508015611af5575060015b611ba357611b016137f0565b806308c379a01415611b625750611b16613a48565b80611b215750611b64565b876000826040517efa072b000000000000000000000000000000000000000000000000000000008152600401611b5993929190613018565b60405180910390fd5b505b8660006040517efa072b000000000000000000000000000000000000000000000000000000008152600401611b9a9291906130ce565b60405180910390fd5b8047611baf91906134b6565b93506000851115611c065784841015611c01578660006040517efa072b000000000000000000000000000000000000000000000000000000008152600401611bf8929190613056565b60405180910390fd5b611c4e565b60008414611c4d578660006040517efa072b000000000000000000000000000000000000000000000000000000008152600401611c44929190613092565b60405180910390fd5b5b5a82611c5a91906134b6565b92505050935093915050565b6000808260800151905060008360400151511115611cb157600083606001515160c8611c929190613428565b617d00611c9f9190613398565b90508082611cad9190613398565b9150505b80915050919050565b6000611cec83610100016020810190611cd39190612354565b83670de0b6b3a7640000611ce79190613398565b611e93565b905092915050565b6000818060400190611d069190613198565b905014611e61576000818060400190611d1f9190613198565b83610140016020810190611d339190612354565b604051602001611d4593929190612cf7565b60405160208183030381529060405290506000826020013590506000818351602085016000f59050600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff161415611ddd576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611dd490612eed565b60405180910390fd5b836000016020810190611df09190612354565b73ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1614611e5d576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611e5490612ecd565b60405180910390fd5b5050505b50565b6000611e8c8260c00135611e87488560e00135611e819190613398565b3a611f0c565b611f0c565b9050919050565b6000816000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160009054906101000a90046dffffffffffffffffffffffffffff166dffffffffffffffffffffffffffff161015905092915050565b6000818310611f1b5781611f1d565b825b905092915050565b604051806060016040528060006dffffffffffffffffffffffffffff16815260200160006dffffffffffffffffffffffffffff168152602001600063ffffffff1681525090565b6000611f7f611f7a84613249565b613224565b905082815260208101848484011115611f9b57611f9a613849565b5b611fa6848285613636565b509392505050565b6000611fc1611fbc84613249565b613224565b905082815260208101848484011115611fdd57611fdc613849565b5b611fe8848285613645565b509392505050565b600081359050611fff81613af2565b92915050565b60008135905061201481613b09565b92915050565b60008083601f8401126120305761202f61381c565b5b8235905067ffffffffffffffff81111561204d5761204c613817565b5b6020830191508360208202830111156120695761206861383f565b5b9250929050565b60008083601f8401126120865761208561381c565b5b8235905067ffffffffffffffff8111156120a3576120a2613817565b5b6020830191508360208202830111156120bf576120be61383f565b5b9250929050565b60008083601f8401126120dc576120db61381c565b5b8235905067ffffffffffffffff8111156120f9576120f8613817565b5b6020830191508360018202830111156121155761211461383f565b5b9250929050565b600082601f8301126121315761213061381c565b5b8135612141848260208601611f6c565b91505092915050565b600082601f83011261215f5761215e61381c565b5b815161216f848260208601611fae565b91505092915050565b6000610180828403121561218f5761218e613826565b5b81905092915050565b600061018082840312156121af576121ae61382b565b5b6121ba610180613224565b905060006121ca84828501611ff0565b60008301525060206121de8482850161232a565b602083015250604082013567ffffffffffffffff8111156122025761220161383a565b5b61220e8482850161211c565b604083015250606082013567ffffffffffffffff8111156122325761223161383a565b5b61223e8482850161211c565b60608301525060806122528482850161232a565b60808301525060a06122668482850161232a565b60a08301525060c061227a8482850161232a565b60c08301525060e061228e8482850161232a565b60e0830152506101006122a384828501611ff0565b6101008301525061012082013567ffffffffffffffff8111156122c9576122c861383a565b5b6122d58482850161211c565b610120830152506101406122eb84828501611ff0565b6101408301525061016082013567ffffffffffffffff8111156123115761231061383a565b5b61231d8482850161211c565b6101608301525092915050565b60008135905061233981613b20565b92915050565b60008151905061234e81613b20565b92915050565b60006020828403121561236a57612369613858565b5b600061237884828501611ff0565b91505092915050565b60006020828403121561239757612396613858565b5b60006123a584828501612005565b91505092915050565b600080602083850312156123c5576123c4613858565b5b600083013567ffffffffffffffff8111156123e3576123e261384e565b5b6123ef8582860161201a565b92509250509250929050565b60008060006040848603121561241457612413613858565b5b600084013567ffffffffffffffff8111156124325761243161384e565b5b61243e86828701612070565b9350935050602061245186828701612005565b9150509250925092565b60006020828403121561247157612470613858565b5b600082015167ffffffffffffffff81111561248f5761248e61384e565b5b61249b8482850161214a565b91505092915050565b6000806000606084860312156124bd576124bc613858565b5b600084013567ffffffffffffffff8111156124db576124da61384e565b5b6124e78682870161211c565b93505060206124f88682870161232a565b925050604061250986828701611ff0565b9150509250925092565b60006020828403121561252957612528613858565b5b600082013567ffffffffffffffff8111156125475761254661384e565b5b61255384828501612178565b91505092915050565b6000806040838503121561257357612572613858565b5b600083013567ffffffffffffffff8111156125915761259061384e565b5b61259d85828601612178565b92505060206125ae85828601612005565b9150509250929050565b6000806000806000608086880312156125d4576125d3613858565b5b600086013567ffffffffffffffff8111156125f2576125f161384e565b5b6125fe88828901612178565b955050602086013567ffffffffffffffff81111561261f5761261e61384e565b5b61262b888289016120c6565b9450945050604061263e8882890161232a565b925050606061264f8882890161232a565b9150509295509295909350565b6000806040838503121561267357612672613858565b5b600083013567ffffffffffffffff8111156126915761269061384e565b5b61269d85828601612178565b92505060206126ae8582860161232a565b9150509250929050565b6000602082840312156126ce576126cd613858565b5b60006126dc8482850161233f565b91505092915050565b60006126f18383612c2e565b60208301905092915050565b612706816135b7565b82525050565b612715816134ea565b82525050565b612724816134ea565b82525050565b61273b612736826134ea565b6136f2565b82525050565b600061274c8261328a565b61275681856132b8565b93506127618361327a565b8060005b8381101561279257815161277988826126e5565b9750612784836132ab565b925050600181019050612765565b5085935050505092915050565b6127a88161350e565b82525050565b6127bf6127ba8261351a565b613704565b82525050565b6127d66127d182613546565b61370e565b82525050565b60006127e883856132c9565b93506127f5838584613636565b6127fe8361385d565b840190509392505050565b600061281583856132eb565b9350612822838584613636565b82840190509392505050565b600061283982613295565b61284381856132da565b9350612853818560208601613645565b61285c8161385d565b840191505092915050565b600061287282613295565b61287c81856132eb565b935061288c818560208601613645565b80840191505092915050565b6128a1816135c9565b82525050565b60006128b2826132a0565b6128bc81856132f6565b93506128cc818560208601613645565b6128d58161385d565b840191505092915050565b60006128ed602c836132f6565b91506128f882613888565b604082019050919050565b6000612910600f836132f6565b915061291b826138d7565b602082019050919050565b60006129336015836132f6565b915061293e82613900565b602082019050919050565b60006129566011836132f6565b915061296182613929565b602082019050919050565b60006129796024836132f6565b915061298482613952565b604082019050919050565b600061299c6019836132f6565b91506129a7826139a1565b602082019050919050565b60006129bf601d836132f6565b91506129ca826139ca565b602082019050919050565b60006129e2600e836132f6565b91506129ed826139f3565b602082019050919050565b6000612a056000836132f6565b9150612a1082613a1c565b600082019050919050565b6000612a286010836132f6565b9150612a3382613a1f565b602082019050919050565b606082016000820151612a546000850182612c01565b506020820151612a676020850182612c01565b506040820151612a7a6040850182612c72565b50505050565b60006101808301612a946000840184613307565b612aa1600086018261270c565b50612aaf6020840184613381565b612abc6020860182612c2e565b50612aca604084018461331e565b8583036040870152612add8382846127dc565b92505050612aee606084018461331e565b8583036060870152612b018382846127dc565b92505050612b126080840184613381565b612b1f6080860182612c2e565b50612b2d60a0840184613381565b612b3a60a0860182612c2e565b50612b4860c0840184613381565b612b5560c0860182612c2e565b50612b6360e0840184613381565b612b7060e0860182612c2e565b50612b7f610100840184613307565b612b8d61010086018261270c565b50612b9c61012084018461331e565b858303610120870152612bb08382846127dc565b92505050612bc2610140840184613307565b612bd061014086018261270c565b50612bdf61016084018461331e565b858303610160870152612bf38382846127dc565b925050508091505092915050565b612c0a81613563565b82525050565b612c1981613563565b82525050565b612c28816135ee565b82525050565b612c378161359d565b82525050565b612c468161359d565b82525050565b612c5d612c588261359d565b61372a565b82525050565b612c6c81613624565b82525050565b612c7b816135a7565b82525050565b612c8a816135a7565b82525050565b6000612c9c82876127ae565b600182019150612cac828661272a565b601482019150612cbc8285612c4c565b602082019150612ccc82846127c5565b60208201915081905095945050505050565b6000612ceb828486612809565b91508190509392505050565b6000612d04828587612809565b9150612d10828461272a565b601482019150819050949350505050565b6000612d2d8285612867565b9150612d39828461272a565b6014820191508190509392505050565b6000602082019050612d5e600083018461271b565b92915050565b6000604082019050612d7960008301856126fd565b612d866020830184612c3d565b9392505050565b6000606082019050612da2600083018661271b565b612daf602083018561271b565b8181036040830152612dc1818461282e565b9050949350505050565b60006020820190508181036000830152612de58184612741565b905092915050565b60006020820190508181036000830152612e07818461282e565b905092915050565b6000606082019050612e246000830186612898565b8181036020830152612e36818561282e565b9050612e456040830184612c3d565b949350505050565b60006020820190508181036000830152612e66816128e0565b9050919050565b60006020820190508181036000830152612e8681612903565b9050919050565b60006020820190508181036000830152612ea681612926565b9050919050565b60006020820190508181036000830152612ec681612949565b9050919050565b60006020820190508181036000830152612ee68161296c565b9050919050565b60006020820190508181036000830152612f06816129d5565b9050919050565b6000606082019050612f226000830184612a3e565b92915050565b60006080820190508181036000830152612f428187612a80565b90508181036020830152612f56818661282e565b9050612f656040830185612c3d565b612f726060830184612c3d565b95945050505050565b60006040820190508181036000830152612f958185612a80565b9050612fa46020830184612c3d565b9392505050565b6000602082019050612fc06000830184612c1f565b92915050565b6000606082019050612fdb6000830186612c10565b612fe86020830185612c10565b612ff56040830184612c81565b949350505050565b60006020820190506130126000830184612c3d565b92915050565b600060608201905061302d6000830186612c3d565b61303a602083018561271b565b818103604083015261304c81846128a7565b9050949350505050565b600060608201905061306b6000830185612c3d565b613078602083018461271b565b81810360408301526130898161298f565b90509392505050565b60006060820190506130a76000830185612c3d565b6130b4602083018461271b565b81810360408301526130c5816129b2565b90509392505050565b60006060820190506130e36000830185612c3d565b6130f0602083018461271b565b8181036040830152613101816129f8565b90509392505050565b600060608201905061311f6000830185612c3d565b61312c602083018461271b565b818103604083015261313d81612a1b565b90509392505050565b600060608201905061315b6000830186612c3d565b6131686020830185612c3d565b613175604083018461279f565b949350505050565b60006020820190506131926000830184612c63565b92915050565b600080833560016020038436030381126131b5576131b4613830565b5b80840192508235915067ffffffffffffffff8211156131d7576131d6613821565b5b6020830192506001820236038313156131f3576131f2613844565b5b509250929050565b6000823560016101800383360303811261321857613217613830565b5b80830191505092915050565b600061322e61323f565b905061323a8282613678565b919050565b6000604051905090565b600067ffffffffffffffff821115613264576132636137c1565b5b61326d8261385d565b9050602081019050919050565b6000819050602082019050919050565b600081519050919050565b600081519050919050565b600081519050919050565b6000602082019050919050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b600081905092915050565b600082825260208201905092915050565b60006133166020840184611ff0565b905092915050565b6000808335600160200384360303811261333b5761333a613853565b5b83810192508235915060208301925067ffffffffffffffff82111561336357613362613812565b5b60018202360384131561337957613378613835565b5b509250929050565b6000613390602084018461232a565b905092915050565b60006133a38261359d565b91506133ae8361359d565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff038211156133e3576133e2613734565b5b828201905092915050565b60006133f9826135a7565b9150613404836135a7565b92508263ffffffff0382111561341d5761341c613734565b5b828201905092915050565b60006134338261359d565b915061343e8361359d565b9250817fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff048311821515161561347757613476613734565b5b828202905092915050565b600061348d82613563565b915061349883613563565b9250828210156134ab576134aa613734565b5b828203905092915050565b60006134c18261359d565b91506134cc8361359d565b9250828210156134df576134de613734565b5b828203905092915050565b60006134f58261357d565b9050919050565b60006135078261357d565b9050919050565b60008115159050919050565b60007fff0000000000000000000000000000000000000000000000000000000000000082169050919050565b6000819050919050565b600081905061355e82613ade565b919050565b60006dffffffffffffffffffffffffffff82169050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b600063ffffffff82169050919050565b60006135c282613600565b9050919050565b60006135d482613550565b9050919050565b60006135e73683612198565b9050919050565b60006135f982613563565b9050919050565b600061360b82613612565b9050919050565b600061361d8261357d565b9050919050565b600061362f826135a7565b9050919050565b82818337600083830152505050565b60005b83811015613663578082015181840152602081019050613648565b83811115613672576000848401525b50505050565b6136818261385d565b810181811067ffffffffffffffff821117156136a05761369f6137c1565b5b80604052505050565b60006136b48261359d565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8214156136e7576136e6613734565b5b600182019050919050565b60006136fd82613718565b9050919050565b6000819050919050565b6000819050919050565b60006137238261386e565b9050919050565b6000819050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b600060033d111561380f5760046000803e61380c60005161387b565b90505b90565b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b60008160601b9050919050565b60008160e01c9050919050565b7f6d7573742062652063616c6c6564206f66662d636861696e207769746820667260008201527f6f6d3d7a65726f2d616464720000000000000000000000000000000000000000602082015250565b7f616c72656164792070656e64696e670000000000000000000000000000000000600082015250565b7f5769746864726177616c206973206e6f74206475650000000000000000000000600082015250565b7f6e6f20756e6c6f636b6564207374616b65000000000000000000000000000000600082015250565b7f74617267657420646f65736e2774206d6174636820637265617465322061646460008201527f7265737300000000000000000000000000000000000000000000000000000000602082015250565b7f77616c6c6574206469646e2774207061792070726566756e6400000000000000600082015250565b7f686173207061796d6173746572206275742077616c6c65742070616964000000600082015250565b7f63726561746532206661696c6564000000000000000000000000000000000000600082015250565b50565b7f6e6f7420656e6f756768207374616b6500000000000000000000000000000000600082015250565b600060443d1015613a5857613adb565b613a6061323f565b60043d036004823e80513d602482011167ffffffffffffffff82111715613a88575050613adb565b808201805167ffffffffffffffff811115613aa65750505050613adb565b80602083010160043d038501811115613ac3575050505050613adb565b613ad282602001850186613678565b82955050505050505b90565b60038110613aef57613aee613763565b5b50565b613afb816134ea565b8114613b0657600080fd5b50565b613b12816134fc565b8114613b1d57600080fd5b50565b613b298161359d565b8114613b3457600080fd5b5056fea2646970667358221220c9d165e7398a481c6ebf86be406e762696fc446e33b9861365a33e98647ef56b64736f6c63430008070033";
            public static string SimpleWalletCode = "0x608060405234801561001057600080fd5b50611cb9806100206000396000f3fe6080604052600436106100955760003560e01c8063b62654fb11610059578063b62654fb14610172578063be6002c21461019d578063c02a6bd5146101c6578063d45109f4146101ef578063f09a4016146102185761009c565b80633a0d58d1146100a157806341ed0e59146100ca5780638da5cb5b146100f3578063a9059cbb1461011e578063affed0e0146101475761009c565b3661009c57005b600080fd5b3480156100ad57600080fd5b506100c860048036038101906100c3919061120e565b610241565b005b3480156100d657600080fd5b506100f160048036038101906100ec9190611021565b610383565b005b3480156100ff57600080fd5b5061010861042a565b60405161011591906114b8565b60405180910390f35b34801561012a57600080fd5b506101456004803603810190610140919061104e565b610450565b005b34801561015357600080fd5b5061015c6104a3565b6040516101699190611712565b60405180910390f35b34801561017e57600080fd5b506101876104a9565b60405161019491906114b8565b60405180910390f35b3480156101a957600080fd5b506101c460048036038101906101bf9190611121565b6104cf565b005b3480156101d257600080fd5b506101ed60048036038101906101e8919061108e565b610556565b005b3480156101fb57600080fd5b50610216600480360381019061021191906111c1565b610674565b005b34801561022457600080fd5b5061023f600480360381019061023a91906110e1565b61074c565b005b600073ffffffffffffffffffffffffffffffffffffffff16600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614806102eb5750600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b61032a576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161032190611672565b60405180910390fd5b610333826108d3565b61033c82610b69565b6000811461037f5760003373ffffffffffffffffffffffffffffffffffffffff166108fc839081150290604051600060405180830381858888f193505050509050505b5050565b61038b610bc7565b7fbf7405b81de3cf3dde24b3ee97cd49371cee922e21a8a7960dfe8e31a0ef9425600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16826040516103de9291906114d3565b60405180910390a180600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b610458610bc7565b8173ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f1935050505015801561049e573d6000803e3d6000fd5b505050565b60005481565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b6104d7610bc7565b60008373ffffffffffffffffffffffffffffffffffffffff168383604051610500929190611479565b6000604051808303816000865af19150503d806000811461053d576040519150601f19603f3d011682016040523d82523d6000602084013e610542565b606091505b505090508061055057600080fd5b50505050565b600073ffffffffffffffffffffffffffffffffffffffff16600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16146105e7576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016105de906116b2565b60405180910390fd5b80600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508273ffffffffffffffffffffffffffffffffffffffff166108fc839081150290604051600060405180830381858888f1935050505015801561066e573d6000803e3d6000fd5b50505050565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146106ce57600080fd5b60003073ffffffffffffffffffffffffffffffffffffffff1683836040516106f7929190611479565b6000604051808303816000865af19150503d8060008114610734576040519150601f19603f3d011682016040523d82523d6000602084013e610739565b606091505b505090508061074757600080fd5b505050565b600073ffffffffffffffffffffffffffffffffffffffff16600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16146107dd576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016107d4906116f2565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff16141561084d576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161084490611612565b60405180910390fd5b81600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555080600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505050565b600073ffffffffffffffffffffffffffffffffffffffff16600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16148061099057508061014001602081019061093f9190611021565b73ffffffffffffffffffffffffffffffffffffffff16600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16145b6109cf576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016109c6906116d2565b60405180910390fd5b60006109e3826109de9061188e565b610cb1565b90506041828061016001906109f8919061172d565b905014610a3a576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610a31906115f2565b60405180910390fd5b60008083806101600190610a4e919061172d565b810190610a5b9190611181565b91509150600084806101600190610a72919061172d565b6040818110610a8457610a83611996565b5b9050013560f81c60f81b60f81c905060018482858560405160008152602001604052604051610ab694939291906115ad565b6020604051602081039080840390855afa158015610ad8573d6000803e3d6000fd5b5050506020604051035173ffffffffffffffffffffffffffffffffffffffff1685610140016020810190610b0c9190611021565b73ffffffffffffffffffffffffffffffffffffffff1614610b62576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610b5990611632565b60405180910390fd5b5050505050565b8060200135600080815480929190610b8090611914565b9190505514610bc4576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610bbb90611692565b60405180910390fd5b50565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161480610c705750600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b610caf576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610ca690611652565b60405180910390fd5b565b6000610cbc82610cf0565b80519060200120604051602001610cd39190611492565b604051602081830303815290604052805190602001209050919050565b6060816000015182602001518360400151846060015185608001518660a001518760c001518860e001518961010001518a6101200151604051602001610d3f9a999897969594939291906114fc565b6040516020818303038152906040529050919050565b6000610d68610d63846117b5565b611790565b905082815260208101848484011115610d8457610d83611a21565b5b610d8f8482856118a1565b509392505050565b600081359050610da681611c27565b92915050565b600081359050610dbb81611c3e565b92915050565b600081359050610dd081611c55565b92915050565b60008083601f840112610dec57610deb6119f9565b5b8235905067ffffffffffffffff811115610e0957610e086119f4565b5b602083019150836001820283011115610e2557610e24611a17565b5b9250929050565b600082601f830112610e4157610e406119f9565b5b8135610e51848260208601610d55565b91505092915050565b60006101808284031215610e7157610e70611a03565b5b81905092915050565b60006101808284031215610e9157610e90611a08565b5b610e9c610180611790565b90506000610eac84828501610d97565b6000830152506020610ec08482850161100c565b602083015250604082013567ffffffffffffffff811115610ee457610ee3611a12565b5b610ef084828501610e2c565b604083015250606082013567ffffffffffffffff811115610f1457610f13611a12565b5b610f2084828501610e2c565b6060830152506080610f348482850161100c565b60808301525060a0610f488482850161100c565b60a08301525060c0610f5c8482850161100c565b60c08301525060e0610f708482850161100c565b60e083015250610100610f8584828501610d97565b6101008301525061012082013567ffffffffffffffff811115610fab57610faa611a12565b5b610fb784828501610e2c565b61012083015250610140610fcd84828501610d97565b6101408301525061016082013567ffffffffffffffff811115610ff357610ff2611a12565b5b610fff84828501610e2c565b6101608301525092915050565b60008135905061101b81611c6c565b92915050565b60006020828403121561103757611036611a2b565b5b600061104584828501610d97565b91505092915050565b6000806040838503121561106557611064611a2b565b5b600061107385828601610dac565b92505060206110848582860161100c565b9150509250929050565b6000806000606084860312156110a7576110a6611a2b565b5b60006110b586828701610dac565b93505060206110c68682870161100c565b92505060406110d786828701610d97565b9150509250925092565b600080604083850312156110f8576110f7611a2b565b5b600061110685828601610d97565b925050602061111785828601610d97565b9150509250929050565b60008060006040848603121561113a57611139611a2b565b5b600061114886828701610d97565b935050602084013567ffffffffffffffff81111561116957611168611a26565b5b61117586828701610dd6565b92509250509250925092565b6000806040838503121561119857611197611a2b565b5b60006111a685828601610dc1565b92505060206111b785828601610dc1565b9150509250929050565b600080602083850312156111d8576111d7611a2b565b5b600083013567ffffffffffffffff8111156111f6576111f5611a26565b5b61120285828601610dd6565b92509250509250929050565b6000806040838503121561122557611224611a2b565b5b600083013567ffffffffffffffff81111561124357611242611a26565b5b61124f85828601610e5a565b92505060206112608582860161100c565b9150509250929050565b61127381611829565b82525050565b6112828161184d565b82525050565b6112996112948261184d565b61195d565b82525050565b60006112ab8385611802565b93506112b88385846118a1565b82840190509392505050565b60006112cf826117e6565b6112d981856117f1565b93506112e98185602086016118b0565b6112f281611a30565b840191505092915050565b600061130a601c8361181e565b915061131582611a41565b601c82019050919050565b600061132d60208361180d565b915061133882611a6a565b602082019050919050565b600061135060228361180d565b915061135b82611a93565b604082019050919050565b600061137360178361180d565b915061137e82611ae2565b602082019050919050565b600061139660278361180d565b91506113a182611b0b565b604082019050919050565b60006113b9601a8361180d565b91506113c482611b5a565b602082019050919050565b60006113dc60158361180d565b91506113e782611b83565b602082019050919050565b60006113ff60158361180d565b915061140a82611bac565b602082019050919050565b600061142260118361180d565b915061142d82611bd5565b602082019050919050565b6000611445601b8361180d565b915061145082611bfe565b602082019050919050565b61146481611877565b82525050565b61147381611881565b82525050565b600061148682848661129f565b91508190509392505050565b600061149d826112fd565b91506114a98284611288565b60208201915081905092915050565b60006020820190506114cd600083018461126a565b92915050565b60006040820190506114e8600083018561126a565b6114f5602083018461126a565b9392505050565b600061014082019050611512600083018d61126a565b61151f602083018c61145b565b8181036040830152611531818b6112c4565b90508181036060830152611545818a6112c4565b9050611554608083018961145b565b61156160a083018861145b565b61156e60c083018761145b565b61157b60e083018661145b565b61158961010083018561126a565b81810361012083015261159c81846112c4565b90509b9a5050505050505050505050565b60006080820190506115c26000830187611279565b6115cf602083018661146a565b6115dc6040830185611279565b6115e96060830184611279565b95945050505050565b6000602082019050818103600083015261160b81611320565b9050919050565b6000602082019050818103600083015261162b81611343565b9050919050565b6000602082019050818103600083015261164b81611366565b9050919050565b6000602082019050818103600083015261166b81611389565b9050919050565b6000602082019050818103600083015261168b816113ac565b9050919050565b600060208201905081810360008301526116ab816113cf565b9050919050565b600060208201905081810360008301526116cb816113f2565b9050919050565b600060208201905081810360008301526116eb81611415565b9050919050565b6000602082019050818103600083015261170b81611438565b9050919050565b6000602082019050611727600083018461145b565b92915050565b6000808335600160200384360303811261174a57611749611a0d565b5b80840192508235915067ffffffffffffffff82111561176c5761176b6119fe565b5b60208301925060018202360383131561178857611787611a1c565b5b509250929050565b600061179a6117ab565b90506117a682826118e3565b919050565b6000604051905090565b600067ffffffffffffffff8211156117d0576117cf6119c5565b5b6117d982611a30565b9050602081019050919050565b600081519050919050565b600082825260208201905092915050565b600081905092915050565b600082825260208201905092915050565b600081905092915050565b600061183482611857565b9050919050565b600061184682611857565b9050919050565b6000819050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b600060ff82169050919050565b600061189a3683610e7a565b9050919050565b82818337600083830152505050565b60005b838110156118ce5780820151818401526020810190506118b3565b838111156118dd576000848401525b50505050565b6118ec82611a30565b810181811067ffffffffffffffff8211171561190b5761190a6119c5565b5b80604052505050565b600061191f82611877565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff82141561195257611951611967565b5b600182019050919050565b6000819050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f19457468657265756d205369676e6564204d6573736167653a0a333200000000600082015250565b7f77616c6c65743a20696e76616c6964207369676e6174757265206c656e677468600082015250565b7f77616c6c65743a2063616e6e6f742068617665206e756c6c2073696e676c657460008201527f6f6e000000000000000000000000000000000000000000000000000000000000602082015250565b7f77616c6c65743a2077726f6e67207369676e6174757265000000000000000000600082015250565b7f77616c6c65743a206f6e6c79207468726f7567682073696e676c65746f6e206f60008201527f72206f776e657200000000000000000000000000000000000000000000000000602082015250565b7f77616c6c65743a206e6f742066726f6d2053696e676c65746f6e000000000000600082015250565b7f77616c6c65743a20696e76616c6964206e6f6e63650000000000000000000000600082015250565b7f73696e676c65746f6e20616c7265616479207365740000000000000000000000600082015250565b7f77616c6c65743a206e6f74206f776e6572000000000000000000000000000000600082015250565b7f77616c6c65743a20616c726561647920696e697469616c697a65640000000000600082015250565b611c3081611829565b8114611c3b57600080fd5b50565b611c478161183b565b8114611c5257600080fd5b50565b611c5e8161184d565b8114611c6957600080fd5b50565b611c7581611877565b8114611c8057600080fd5b5056fea2646970667358221220a538190fa214fac03d2aaf176d838da31b00a3e411da449ae6015806da53269264736f6c63430008070033";
            public static string SimplePaymasterCode = "0x6080604052610bb86001553480156200001757600080fd5b5060405162003ccd38038062003ccd83398181016040528101906200003d919062000247565b6200005d620000516200013f60201b60201c565b6200014760201b60201c565b81600360006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555080600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060016004600060405180602001620000f7906200020b565b6020820181038252601f19601f8201166040525080519060200120815260200190815260200160002060006101000a81548160ff021916908315150217905550505062000337565b600033905090565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050816000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b61217d8062001b5083390190565b6000815190506200022a8162000303565b92915050565b60008151905062000241816200031d565b92915050565b60008060408385031215620002615762000260620002fe565b5b6000620002718582860162000230565b9250506020620002848582860162000219565b9150509250929050565b60006200029b82620002de565b9050919050565b6000620002af82620002de565b9050919050565b6000620002c3826200028e565b9050919050565b6000620002d782620002a2565b9050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b600080fd5b6200030e81620002b6565b81146200031a57600080fd5b50565b6200032881620002ca565b81146200033457600080fd5b50565b61180980620003476000396000f3fe60806040526004361061007b5760003560e01c8063715018a61161004e578063715018a6146101195780638da5cb5b14610130578063b158094c1461015b578063f2fde38b146101985761007b565b806306b091f91461008057806346ca982e146100a957806352d570bd146100d25780635a627dbc1461010f575b600080fd5b34801561008c57600080fd5b506100a760048036038101906100a29190610e30565b6101c1565b005b3480156100b557600080fd5b506100d060048036038101906100cb9190610eca565b6102f1565b005b3480156100de57600080fd5b506100f960048036038101906100f49190610f4d565b6103d6565b60405161010691906111ce565b60405180910390f35b6101176107b1565b005b34801561012557600080fd5b5061012e610836565b005b34801561013c57600080fd5b506101456108be565b604051610152919061110f565b60405180910390f35b34801561016757600080fd5b50610182600480360381019061017d9190610e9d565b6108e7565b60405161018f91906111b3565b60405180910390f35b3480156101a457600080fd5b506101bf60048036038101906101ba9190610e03565b610907565b005b6101c96109ff565b73ffffffffffffffffffffffffffffffffffffffff166101e76108be565b73ffffffffffffffffffffffffffffffffffffffff161461023d576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161023490611249565b60405180910390fd5b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663a9059cbb83836040518363ffffffff1660e01b815260040161029a92919061118a565b602060405180830381600087803b1580156102b457600080fd5b505af11580156102c8573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906102ec9190610e70565b505050565b600061030960015483610304919061137e565b610a07565b9050600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166323b872dd85600001602081019061035c9190610e03565b30846040518463ffffffff1660e01b815260040161037c93929190611153565b602060405180830381600087803b15801561039657600080fd5b505af11580156103aa573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906103ce9190610e70565b505050505050565b6000806103f36103ee846103e9906114c5565b610a1d565b610a07565b9050600083806040019061040791906112a9565b9050146105a457600083806040019061042091906112a9565b60405161042e9291906110f6565b604051809103902090506004600082815260200190815260200160002060009054906101000a900460ff16610498576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161048f90611229565b60405180910390fd5b81600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166370a082318660000160208101906104ea9190610e03565b6040518263ffffffff1660e01b8152600401610506919061110f565b60206040518083038186803b15801561051e57600080fd5b505afa158015610532573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906105569190610f96565b11610596576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161058d90611269565b60405180910390fd5b600160001b925050506107ac565b80600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166370a082318560000160208101906105f69190610e03565b6040518263ffffffff1660e01b8152600401610612919061110f565b60206040518083038186803b15801561062a57600080fd5b505afa15801561063e573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906106629190610f96565b116106a2576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161069990611289565b60405180910390fd5b80600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663dd62ed3e8560000160208101906106f49190610e03565b306040518363ffffffff1660e01b815260040161071292919061112a565b60206040518083038186803b15801561072a57600080fd5b505afa15801561073e573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906107629190610f96565b10156107a3576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161079a90611209565b60405180910390fd5b600160001b9150505b919050565b600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16635a627dbc346040518263ffffffff1660e01b81526004016000604051808303818588803b15801561081b57600080fd5b505af115801561082f573d6000803e3d6000fd5b5050505050565b61083e6109ff565b73ffffffffffffffffffffffffffffffffffffffff1661085c6108be565b73ffffffffffffffffffffffffffffffffffffffff16146108b2576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016108a990611249565b60405180910390fd5b6108bc6000610a48565b565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b60046020528060005260406000206000915054906101000a900460ff1681565b61090f6109ff565b73ffffffffffffffffffffffffffffffffffffffff1661092d6108be565b73ffffffffffffffffffffffffffffffffffffffff1614610983576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161097a90611249565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1614156109f3576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016109ea906111e9565b60405180910390fd5b6109fc81610a48565b50565b600033905090565b6000606482610a1691906113d4565b9050919050565b60008160c0015167ffffffffffffffff16610a3783610b0c565b610a419190611405565b9050919050565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050816000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b600080826080015167ffffffffffffffff16905060008360400151511115610b6157600083606001515160c8610b429190611405565b617d00610b4f919061137e565b90508082610b5d919061137e565b9150505b80915050919050565b6000610b7d610b7884611331565b61130c565b905082815260208101848484011115610b9957610b986115c8565b5b610ba48482856114d8565b509392505050565b600081359050610bbb81611750565b92915050565b600081519050610bd081611767565b92915050565b600081359050610be58161177e565b92915050565b600082601f830112610c0057610bff6115a5565b5b8135610c10848260208601610b6a565b91505092915050565b600081359050610c2881611795565b92915050565b60006101808284031215610c4557610c446115af565b5b81905092915050565b60006101808284031215610c6557610c646115b4565b5b610c7061018061130c565b90506000610c8084828501610bac565b6000830152506020610c9484828501610dc4565b602083015250604082013567ffffffffffffffff811115610cb857610cb76115be565b5b610cc484828501610beb565b604083015250606082013567ffffffffffffffff811115610ce857610ce76115be565b5b610cf484828501610beb565b6060830152506080610d0884828501610dee565b60808301525060a0610d1c84828501610dc4565b60a08301525060c0610d3084828501610dee565b60c08301525060e0610d4484828501610dee565b60e083015250610100610d5984828501610bac565b61010083015250610120610d6f84828501610bd6565b61012083015250610140610d8584828501610bac565b6101408301525061016082013567ffffffffffffffff811115610dab57610daa6115be565b5b610db784828501610beb565b6101608301525092915050565b600081359050610dd3816117a5565b92915050565b600081519050610de8816117a5565b92915050565b600081359050610dfd816117bc565b92915050565b600060208284031215610e1957610e186115d2565b5b6000610e2784828501610bac565b91505092915050565b60008060408385031215610e4757610e466115d2565b5b6000610e5585828601610bac565b9250506020610e6685828601610dc4565b9150509250929050565b600060208284031215610e8657610e856115d2565b5b6000610e9484828501610bc1565b91505092915050565b600060208284031215610eb357610eb26115d2565b5b6000610ec184828501610bd6565b91505092915050565b60008060008060808587031215610ee457610ee36115d2565b5b6000610ef287828801610c19565b945050602085013567ffffffffffffffff811115610f1357610f126115cd565b5b610f1f87828801610c2e565b9350506040610f3087828801610bd6565b9250506060610f4187828801610dc4565b91505092959194509250565b600060208284031215610f6357610f626115d2565b5b600082013567ffffffffffffffff811115610f8157610f806115cd565b5b610f8d84828501610c2e565b91505092915050565b600060208284031215610fac57610fab6115d2565b5b6000610fba84828501610dd9565b91505092915050565b610fcc8161145f565b82525050565b610fdb81611471565b82525050565b610fea8161147d565b82525050565b6000610ffc8385611362565b93506110098385846114d8565b82840190509392505050565b600061102260268361136d565b915061102d826115e8565b604082019050919050565b6000611045601c8361136d565b915061105082611637565b602082019050919050565b6000611068602a8361136d565b915061107382611660565b604082019050919050565b600061108b60208361136d565b9150611096826116af565b602082019050919050565b60006110ae60278361136d565b91506110b9826116d8565b604082019050919050565b60006110d1601a8361136d565b91506110dc82611727565b602082019050919050565b6110f0816114a7565b82525050565b6000611103828486610ff0565b91508190509392505050565b60006020820190506111246000830184610fc3565b92915050565b600060408201905061113f6000830185610fc3565b61114c6020830184610fc3565b9392505050565b60006060820190506111686000830186610fc3565b6111756020830185610fc3565b61118260408301846110e7565b949350505050565b600060408201905061119f6000830185610fc3565b6111ac60208301846110e7565b9392505050565b60006020820190506111c86000830184610fd2565b92915050565b60006020820190506111e36000830184610fe1565b92915050565b6000602082019050818103600083015261120281611015565b9050919050565b6000602082019050818103600083015261122281611038565b9050919050565b600060208201905081810360008301526112428161105b565b9050919050565b600060208201905081810360008301526112628161107e565b9050919050565b60006020820190508181036000830152611282816110a1565b9050919050565b600060208201905081810360008301526112a2816110c4565b9050919050565b600080833560016020038436030381126112c6576112c56115b9565b5b80840192508235915067ffffffffffffffff8211156112e8576112e76115aa565b5b602083019250600182023603831315611304576113036115c3565b5b509250929050565b6000611316611327565b905061132282826114e7565b919050565b6000604051905090565b600067ffffffffffffffff82111561134c5761134b611576565b5b611355826115d7565b9050602081019050919050565b600081905092915050565b600082825260208201905092915050565b6000611389826114a7565b9150611394836114a7565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff038211156113c9576113c8611518565b5b828201905092915050565b60006113df826114a7565b91506113ea836114a7565b9250826113fa576113f9611547565b5b828204905092915050565b6000611410826114a7565b915061141b836114a7565b9250817fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff048311821515161561145457611453611518565b5b828202905092915050565b600061146a82611487565b9050919050565b60008115159050919050565b6000819050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b600067ffffffffffffffff82169050919050565b60006114d13683610c4e565b9050919050565b82818337600083830152505050565b6114f0826115d7565b810181811067ffffffffffffffff8211171561150f5761150e611576565b5b80604052505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4f776e61626c653a206e6577206f776e657220697320746865207a65726f206160008201527f6464726573730000000000000000000000000000000000000000000000000000602082015250565b7f546f6b656e5061796d61737465723a206e6f20616c6c6f77616e636500000000600082015250565b7f546f6b656e5061796d61737465723a20756e6b6e6f776e2077616c6c6574206360008201527f6f6e7374727563746f7200000000000000000000000000000000000000000000602082015250565b7f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e6572600082015250565b7f546f6b656e5061796d61737465723a206e6f2062616c616e636520287072652d60008201527f6372656174652900000000000000000000000000000000000000000000000000602082015250565b7f546f6b656e5061796d61737465723a206e6f2062616c616e6365000000000000600082015250565b6117598161145f565b811461176457600080fd5b50565b61177081611471565b811461177b57600080fd5b50565b6117878161147d565b811461179257600080fd5b50565b600381106117a257600080fd5b50565b6117ae816114a7565b81146117b957600080fd5b50565b6117c5816114b1565b81146117d057600080fd5b5056fea26469706673582212200b754e44d488c67dc613d722cbdaa42b4afafcf9385682666259d991dccd0d4a64736f6c63430008070033608060405234801561001057600080fd5b5061215d806100206000396000f3fe6080604052600436106100a05760003560e01c8063b62654fb11610064578063b62654fb1461017d578063be6002c2146101a8578063c02a6bd5146101d1578063d45109f4146101fa578063d68a7a6d14610223578063f09a40161461024c576100a7565b806306552ff3146100ac57806341ed0e59146100d55780638da5cb5b146100fe578063a9059cbb14610129578063affed0e014610152576100a7565b366100a757005b600080fd5b3480156100b857600080fd5b506100d360048036038101906100ce9190611380565b610275565b005b3480156100e157600080fd5b506100fc60048036038101906100f79190611280565b610333565b005b34801561010a57600080fd5b506101136103da565b60405161012091906117ca565b60405180910390f35b34801561013557600080fd5b50610150600480360381019061014b91906112ad565b610400565b005b34801561015e57600080fd5b50610167610453565b6040516101749190611a66565b60405180910390f35b34801561018957600080fd5b50610192610459565b60405161019f91906117ca565b60405180910390f35b3480156101b457600080fd5b506101cf60048036038101906101ca91906113e7565b61047f565b005b3480156101dd57600080fd5b506101f860048036038101906101f391906112ed565b610506565b005b34801561020657600080fd5b50610221600480360381019061021c91906114b4565b610624565b005b34801561022f57600080fd5b5061024a60048036038101906102459190611501565b6106fc565b005b34801561025857600080fd5b50610273600480360381019061026e9190611340565b610885565b005b61027f8484610885565b8173ffffffffffffffffffffffffffffffffffffffff1663095ea7b3827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff6040518363ffffffff1660e01b81526004016102da92919061180e565b602060405180830381600087803b1580156102f457600080fd5b505af1158015610308573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061032c9190611447565b5050505050565b61033b610a0c565b7fbf7405b81de3cf3dde24b3ee97cd49371cee922e21a8a7960dfe8e31a0ef9425600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff168260405161038e9291906117e5565b60405180910390a180600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b610408610a0c565b8173ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f1935050505015801561044e573d6000803e3d6000fd5b505050565b60005481565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b610487610a0c565b60008373ffffffffffffffffffffffffffffffffffffffff1683836040516104b092919061178b565b6000604051808303816000865af19150503d80600081146104ed576040519150601f19603f3d011682016040523d82523d6000602084013e6104f2565b606091505b505090508061050057600080fd5b50505050565b600073ffffffffffffffffffffffffffffffffffffffff16600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614610597576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161058e906119e6565b60405180910390fd5b80600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508273ffffffffffffffffffffffffffffffffffffffff166108fc839081150290604051600060405180830381858888f1935050505015801561061e573d6000803e3d6000fd5b50505050565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461067e57600080fd5b60003073ffffffffffffffffffffffffffffffffffffffff1683836040516106a792919061178b565b6000604051808303816000865af19150503d80600081146106e4576040519150601f19603f3d011682016040523d82523d6000602084013e6106e9565b606091505b50509050806106f757600080fd5b505050565b600073ffffffffffffffffffffffffffffffffffffffff16600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614806107a65750600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b6107e5576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016107dc906119a6565b60405180910390fd5b6107ee81610af6565b6107f781610d8c565b600061080282610dea565b905060008114610881573373ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050610880576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161087790611a26565b60405180910390fd5b5b5050565b600073ffffffffffffffffffffffffffffffffffffffff16600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614610916576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161090d90611a46565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415610986576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161097d90611946565b60405180910390fd5b81600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555080600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505050565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161480610ab55750600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b610af4576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610aeb90611986565b60405180910390fd5b565b600073ffffffffffffffffffffffffffffffffffffffff16600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161480610bb3575080610140016020810190610b629190611280565b73ffffffffffffffffffffffffffffffffffffffff16600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16145b610bf2576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610be990611a06565b60405180910390fd5b6000610c0682610c0190611cc4565b610e26565b9050604182806101600190610c1b9190611a81565b905014610c5d576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610c5490611926565b60405180910390fd5b60008083806101600190610c719190611a81565b810190610c7e9190611474565b91509150600084806101600190610c959190611a81565b6040818110610ca757610ca6611dcc565b5b9050013560f81c60f81b60f81c905060018482858560405160008152602001604052604051610cd994939291906118e1565b6020604051602081039080840390855afa158015610cfb573d6000803e3d6000fd5b5050506020604051035173ffffffffffffffffffffffffffffffffffffffff1685610140016020810190610d2f9190611280565b73ffffffffffffffffffffffffffffffffffffffff1614610d85576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610d7c90611966565b60405180910390fd5b5050505050565b8060200135600080815480929190610da390611d4a565b9190505514610de7576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610dde906119c6565b60405180910390fd5b50565b6000610dfe82610df990611cc4565b610e65565b15610e0c5760009050610e21565b610e1e82610e1990611cc4565b610ea3565b90505b919050565b6000610e3182610ece565b80519060200120604051602001610e4891906117a4565b604051602081830303815290604052805190602001209050919050565b60008073ffffffffffffffffffffffffffffffffffffffff1682610100015173ffffffffffffffffffffffffffffffffffffffff1614159050919050565b60008160c0015167ffffffffffffffff16610ebd83610f33565b610ec79190611bd3565b9050919050565b6060816000015182602001518360400151846060015185608001518660a001518760c001518860e001518961010001518a6101200151604051602001610f1d9a99989796959493929190611837565b6040516020818303038152906040529050919050565b600080826080015167ffffffffffffffff16905060008360400151511115610f8857600083606001515160c8610f699190611bd3565b617d00610f769190611b7d565b90508082610f849190611b7d565b9150505b80915050919050565b6000610fa4610f9f84611b09565b611ae4565b905082815260208101848484011115610fc057610fbf611e57565b5b610fcb848285611cd7565b509392505050565b600081359050610fe281612086565b92915050565b600081359050610ff78161209d565b92915050565b60008151905061100c816120b4565b92915050565b600081359050611021816120cb565b92915050565b60008083601f84011261103d5761103c611e2f565b5b8235905067ffffffffffffffff81111561105a57611059611e2a565b5b60208301915083600182028301111561107657611075611e4d565b5b9250929050565b600082601f83011261109257611091611e2f565b5b81356110a2848260208601610f91565b91505092915050565b6000813590506110ba816120e2565b92915050565b600061018082840312156110d7576110d6611e39565b5b81905092915050565b600061018082840312156110f7576110f6611e3e565b5b611102610180611ae4565b9050600061111284828501610fd3565b600083015250602061112684828501611256565b602083015250604082013567ffffffffffffffff81111561114a57611149611e48565b5b6111568482850161107d565b604083015250606082013567ffffffffffffffff81111561117a57611179611e48565b5b6111868482850161107d565b606083015250608061119a8482850161126b565b60808301525060a06111ae84828501611256565b60a08301525060c06111c28482850161126b565b60c08301525060e06111d68482850161126b565b60e0830152506101006111eb84828501610fd3565b6101008301525061012061120184828501611012565b6101208301525061014061121784828501610fd3565b6101408301525061016082013567ffffffffffffffff81111561123d5761123c611e48565b5b6112498482850161107d565b6101608301525092915050565b600081359050611265816120f9565b92915050565b60008135905061127a81612110565b92915050565b60006020828403121561129657611295611e61565b5b60006112a484828501610fd3565b91505092915050565b600080604083850312156112c4576112c3611e61565b5b60006112d285828601610fe8565b92505060206112e385828601611256565b9150509250929050565b60008060006060848603121561130657611305611e61565b5b600061131486828701610fe8565b935050602061132586828701611256565b925050604061133686828701610fd3565b9150509250925092565b6000806040838503121561135757611356611e61565b5b600061136585828601610fd3565b925050602061137685828601610fd3565b9150509250929050565b6000806000806080858703121561139a57611399611e61565b5b60006113a887828801610fd3565b94505060206113b987828801610fd3565b93505060406113ca878288016110ab565b92505060606113db87828801610fd3565b91505092959194509250565b600080600060408486031215611400576113ff611e61565b5b600061140e86828701610fd3565b935050602084013567ffffffffffffffff81111561142f5761142e611e5c565b5b61143b86828701611027565b92509250509250925092565b60006020828403121561145d5761145c611e61565b5b600061146b84828501610ffd565b91505092915050565b6000806040838503121561148b5761148a611e61565b5b600061149985828601611012565b92505060206114aa85828601611012565b9150509250929050565b600080602083850312156114cb576114ca611e61565b5b600083013567ffffffffffffffff8111156114e9576114e8611e5c565b5b6114f585828601611027565b92509250509250929050565b60006020828403121561151757611516611e61565b5b600082013567ffffffffffffffff81111561153557611534611e5c565b5b611541848285016110c0565b91505092915050565b61155381611c2d565b82525050565b61156281611c5d565b82525050565b61157961157482611c5d565b611d93565b82525050565b600061158b8385611b56565b9350611598838584611cd7565b82840190509392505050565b60006115af82611b3a565b6115b98185611b45565b93506115c9818560208601611ce6565b6115d281611e66565b840191505092915050565b60006115ea601c83611b72565b91506115f582611e77565b601c82019050919050565b600061160d602083611b61565b915061161882611ea0565b602082019050919050565b6000611630602283611b61565b915061163b82611ec9565b604082019050919050565b6000611653601783611b61565b915061165e82611f18565b602082019050919050565b6000611676602783611b61565b915061168182611f41565b604082019050919050565b6000611699601a83611b61565b91506116a482611f90565b602082019050919050565b60006116bc601583611b61565b91506116c782611fb9565b602082019050919050565b60006116df601583611b61565b91506116ea82611fe2565b602082019050919050565b6000611702601183611b61565b915061170d8261200b565b602082019050919050565b6000611725601083611b61565b915061173082612034565b602082019050919050565b6000611748601b83611b61565b91506117538261205d565b602082019050919050565b61176781611c99565b82525050565b61177681611ca3565b82525050565b61178581611cb7565b82525050565b600061179882848661157f565b91508190509392505050565b60006117af826115dd565b91506117bb8284611568565b60208201915081905092915050565b60006020820190506117df600083018461154a565b92915050565b60006040820190506117fa600083018561154a565b611807602083018461154a565b9392505050565b6000604082019050611823600083018561154a565b611830602083018461175e565b9392505050565b60006101408201905061184d600083018d61154a565b61185a602083018c61175e565b818103604083015261186c818b6115a4565b90508181036060830152611880818a6115a4565b905061188f608083018961176d565b61189c60a083018861175e565b6118a960c083018761176d565b6118b660e083018661176d565b6118c461010083018561154a565b6118d2610120830184611559565b9b9a5050505050505050505050565b60006080820190506118f66000830187611559565b611903602083018661177c565b6119106040830185611559565b61191d6060830184611559565b95945050505050565b6000602082019050818103600083015261193f81611600565b9050919050565b6000602082019050818103600083015261195f81611623565b9050919050565b6000602082019050818103600083015261197f81611646565b9050919050565b6000602082019050818103600083015261199f81611669565b9050919050565b600060208201905081810360008301526119bf8161168c565b9050919050565b600060208201905081810360008301526119df816116af565b9050919050565b600060208201905081810360008301526119ff816116d2565b9050919050565b60006020820190508181036000830152611a1f816116f5565b9050919050565b60006020820190508181036000830152611a3f81611718565b9050919050565b60006020820190508181036000830152611a5f8161173b565b9050919050565b6000602082019050611a7b600083018461175e565b92915050565b60008083356001602003843603038112611a9e57611a9d611e43565b5b80840192508235915067ffffffffffffffff821115611ac057611abf611e34565b5b602083019250600182023603831315611adc57611adb611e52565b5b509250929050565b6000611aee611aff565b9050611afa8282611d19565b919050565b6000604051905090565b600067ffffffffffffffff821115611b2457611b23611dfb565b5b611b2d82611e66565b9050602081019050919050565b600081519050919050565b600082825260208201905092915050565b600081905092915050565b600082825260208201905092915050565b600081905092915050565b6000611b8882611c99565b9150611b9383611c99565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff03821115611bc857611bc7611d9d565b5b828201905092915050565b6000611bde82611c99565b9150611be983611c99565b9250817fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0483118215151615611c2257611c21611d9d565b5b828202905092915050565b6000611c3882611c79565b9050919050565b6000611c4a82611c79565b9050919050565b60008115159050919050565b6000819050919050565b6000611c7282611c2d565b9050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b600067ffffffffffffffff82169050919050565b600060ff82169050919050565b6000611cd036836110e0565b9050919050565b82818337600083830152505050565b60005b83811015611d04578082015181840152602081019050611ce9565b83811115611d13576000848401525b50505050565b611d2282611e66565b810181811067ffffffffffffffff82111715611d4157611d40611dfb565b5b80604052505050565b6000611d5582611c99565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff821415611d8857611d87611d9d565b5b600182019050919050565b6000819050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f19457468657265756d205369676e6564204d6573736167653a0a333200000000600082015250565b7f77616c6c65743a20696e76616c6964207369676e6174757265206c656e677468600082015250565b7f77616c6c65743a2063616e6e6f742068617665206e756c6c2073696e676c657460008201527f6f6e000000000000000000000000000000000000000000000000000000000000602082015250565b7f77616c6c65743a2077726f6e67207369676e6174757265000000000000000000600082015250565b7f77616c6c65743a206f6e6c79207468726f7567682073696e676c65746f6e206f60008201527f72206f776e657200000000000000000000000000000000000000000000000000602082015250565b7f77616c6c65743a206e6f742066726f6d2053696e676c65746f6e000000000000600082015250565b7f77616c6c65743a20696e76616c6964206e6f6e63650000000000000000000000600082015250565b7f73696e676c65746f6e20616c7265616479207365740000000000000000000000600082015250565b7f77616c6c65743a206e6f74206f776e6572000000000000000000000000000000600082015250565b7f6661696c656420746f2070726570617900000000000000000000000000000000600082015250565b7f77616c6c65743a20616c726561647920696e697469616c697a65640000000000600082015250565b61208f81611c2d565b811461209a57600080fd5b50565b6120a681611c3f565b81146120b157600080fd5b50565b6120bd81611c51565b81146120c857600080fd5b50565b6120d481611c5d565b81146120df57600080fd5b50565b6120eb81611c67565b81146120f657600080fd5b50565b61210281611c99565b811461210d57600080fd5b50565b61211981611ca3565b811461212457600080fd5b5056fea264697066735822122038502fcc6d8598f22f417d7dd313b66c2dce1530249b35ee665895822818dcbc64736f6c63430008070033";
            public static string TestCounterCode = "0x608060405234801561001057600080fd5b5061029b806100206000396000f3fe608060405234801561001057600080fd5b50600436106100365760003560e01c806306661abd1461003b578063be65ab8c14610045575b600080fd5b610043610075565b005b61005f600480360381019061005a9190610131565b610104565b60405161006c919061016d565b60405180910390f35b60016000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020546100c09190610188565b6000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002081905550565b60006020528060005260406000206000915090505481565b60008135905061012b8161024e565b92915050565b60006020828403121561014757610146610249565b5b60006101558482850161011c565b91505092915050565b61016781610210565b82525050565b6000602082019050610182600083018461015e565b92915050565b600061019382610210565b915061019e83610210565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff038211156101d3576101d261021a565b5b828201905092915050565b60006101e9826101f0565b9050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b600080fd5b610257816101de565b811461026257600080fd5b5056fea2646970667358221220e4e40c4220ddaa7c352afa2724b5bf4305ac67b751f87cdb954b6bec294d116564736f6c63430008070033";

            public static string GetCount(Address walletAddress) => $"0xbe65ab8c000000000000000000000000{walletAddress.ToString().Substring(2, 40)}";
            public static string InitWallet(Address singletonAddress, Address walletOwner) => $"0xf09a4016000000000000000000000000{singletonAddress.ToString().Substring(2, 40)}000000000000000000000000{walletOwner.ToString().Substring(2, 40)}";
            
            public static long LargeGasLimit = 2_000_000;
            
            private static PrivateKey ContractCreatorPrivateKey = TestItem.PrivateKeyC;

            public static UInt256 GetCount(TestRpcBlockchain chain, Address counter, Address wallet)
            {
                Transaction getCountTransaction = Core.Test.Builders.Build.A.Transaction
                    .WithTo(counter)
                    .WithGasLimit(100_000)
                    .WithValue(0)
                    .WithData(Bytes.FromHexString(Contracts.GetCount(wallet!)))
                    .SignedAndResolved(TestItem.PrivateKeyA)
                    .TestObject;
            
                UInt256 count = new UInt256(Bytes.FromHexString(chain.EthRpcModule.eth_call(new TransactionForRpc(getCountTransaction)).Data), true);

                return count;
            }

            public static async Task<(Address, Address?, Address?)> Deploy(TestAccountAbstractionRpcBlockchain chain, string? walletCode = null, string? miscContractCode = null)
            {
                bool createWallet = walletCode is not null;
                bool createMiscContract = miscContractCode is not null;
                
                
                IList<Transaction> transactionsToInclude = new List<Transaction>();

                Transaction singletonTx = Core.Test.Builders.Build.A.Transaction.WithCode(Bytes.FromHexString(SingletonCode)).WithGasLimit(6_000_000).WithNonce(0).WithValue(0).SignedAndResolved(ContractCreatorPrivateKey).TestObject;
                transactionsToInclude.Add(singletonTx);
                
                Transaction? walletTx = createWallet ? Core.Test.Builders.Build.A.Transaction.WithCode(Bytes.FromHexString(walletCode!)).WithGasLimit(LargeGasLimit).WithNonce(1).WithValue(0).SignedAndResolved(ContractCreatorPrivateKey).TestObject : null;
                if (createWallet) transactionsToInclude.Add(walletTx!);
                
                Transaction? miscContractTx = createMiscContract ? Core.Test.Builders.Build.A.Transaction.WithCode(Bytes.FromHexString(miscContractCode!)).WithGasLimit(LargeGasLimit).WithNonce(2).WithValue(0).SignedAndResolved(ContractCreatorPrivateKey).TestObject : null;
                if (createMiscContract) transactionsToInclude.Add(miscContractTx!);
                
                await chain.AddBlock(true, transactionsToInclude.ToArray());

                TxReceipt createSingletonTxReceipt = chain.Bridge.GetReceipt(singletonTx.Hash!);
                TxReceipt? createWalletTxReceipt = createWallet ? chain.Bridge.GetReceipt(walletTx.Hash!) : null;
                TxReceipt? miscContractTxReceipt = createMiscContract ? chain.Bridge.GetReceipt(miscContractTx.Hash!) : null;
                createSingletonTxReceipt.ContractAddress.Should().NotBeNull($"Contract transaction {singletonTx.Hash!} was not deployed.");
                createWalletTxReceipt?.ContractAddress.Should().NotBeNull($"Contract transaction {walletTx?.Hash!} was not deployed.");
                miscContractTxReceipt?.ContractAddress.Should().NotBeNull($"Contract transaction {miscContractTx?.Hash!} was not deployed.");

                chain.State.GetCode(createSingletonTxReceipt.ContractAddress!).Should().NotBeNullOrEmpty();
                if (createWallet) chain.State.GetCode(createWalletTxReceipt?.ContractAddress!).Should().NotBeNullOrEmpty();
                if (createMiscContract) chain.State.GetCode(miscContractTxReceipt?.ContractAddress!).Should().NotBeNullOrEmpty();
                
                return (createSingletonTxReceipt.ContractAddress!, createWalletTxReceipt?.ContractAddress!, miscContractTxReceipt?.ContractAddress!);
            }
        }

        [Test]
        public async Task Should_deploy_contracts_successfully()
        {
            var chain = await CreateChain();
            (Address singletonAddress, Address? walletAddress, _) = await Contracts.Deploy(chain, Contracts.SimpleWalletCode);
        }
        
        [Test]
        public async Task Should_execute_well_formed_op_successfully()
        {
            var chain = await CreateChain();
            (Address singletonAddress, Address? walletAddress, Address? counterAddress) = await Contracts.Deploy(chain, Contracts.SimpleWalletCode, Contracts.TestCounterCode);
            
            UserOperation op = Build.A.UserOperation
                .WithTarget(walletAddress!)
                .WithCallData(Bytes.FromHexString($"0xbe6002c2000000000000000000000000{counterAddress!.ToString().Substring(2, 40)}0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000406661abd00000000000000000000000000000000000000000000000000000000"))
                .SignedAndResolved(TestItem.PrivateKeyA)
                .TestObject;
            
            Transaction initTransaction = Core.Test.Builders.Build.A.Transaction
                .WithTo(walletAddress!)
                .WithValue(0)
                .WithGasPrice(2)
                .WithGasLimit(100_000)
                .WithData(Bytes.FromHexString(Contracts.InitWallet(singletonAddress, TestItem.AddressA)))
                .SignedAndResolved(TestItem.PrivateKeyB)
                .TestObject;
            await chain.AddBlock(true, initTransaction);
            
            Transaction fundTransaction = Core.Test.Builders.Build.A.Transaction
                .WithTo(walletAddress!)
                .WithGasLimit(100_000)
                .WithGasPrice(2)
                .WithValue(1.Ether())
                .WithNonce(1)
                .SignedAndResolved(TestItem.PrivateKeyB).TestObject;
            await chain.AddBlock(true, fundTransaction);

            UInt256 countBefore = Contracts.GetCount(chain, counterAddress, walletAddress!);
            countBefore.Should().Be(0);

            chain.SendUserOperation(op);
            await chain.AddBlock(true);

            UInt256 countAfter = Contracts.GetCount(chain, counterAddress, walletAddress!);
            countAfter.Should().Be(1);
        }

        [Test]
        public void Op_is_signed_correctly()
        {
            
            PrivateKey privateKey = new PrivateKey("0x1111111111111111111111111111111111111111111111111111111111111111");

            UserOperation op = new UserOperation(
                new Address("0x4ed7c70F96B99c776995fB64377f0d4aB3B0e1C1"),
                0,
                Bytes.FromHexString(
                    "0xbe6002c200000000000000000000000009635f643e140090a9a8dcd712ed6285858cebef0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000406661abd00000000000000000000000000000000000000000000000000000000"),
                Bytes.Empty,
                107960,
                500000,
                0,
                0,
                Address.Zero,
                privateKey.Address,
                new Signature(0, 1, 1000),
                Bytes.Empty); 
            
            SignUserOperation(op, privateKey);

            op.Signature!.ToString().Should().Be("0x1f50c8fc848c511183e2fde3002db949c6769b9d22eab0cafa95b74d05420d2344c26632f2d0d1c3bb7effb5bae49231cfd63a314201b0a30976e23dec18bdb51c");
        }

        public static void SignUserOperation(UserOperation op, PrivateKey privateKey)
        {
            AbiSignature abiSignature = new AbiSignature("userOperation", 
                AbiType.Address, 
                AbiType.UInt256,
                AbiType.DynamicBytes,
                AbiType.DynamicBytes,
                AbiType.UInt256,
                AbiType.UInt256,
                AbiType.UInt256,
                AbiType.UInt256,
                AbiType.Address,
                AbiType.DynamicBytes);

            byte[] bytes = AbiEncoder.Instance.Encode(AbiEncodingStyle.None, abiSignature,
                op.Target!,
                op.Nonce,
                op.InitCode!,
                op.CallData!,
                op.CallGas,
                op.VerificationGas,
                op.MaxFeePerGas,
                op.MaxPriorityFeePerGas,
                op.Paymaster!,
                op.PaymasterData!);

            Keccak abiMessage = Keccak.Compute(bytes);

            Signer signer = new(1, privateKey, NullLogManager.Instance);
            Signature signature = signer.Sign(Keccak.Compute(
                    Bytes.Concat(
                        Encoding.UTF8.GetBytes("\x19"),
                        Encoding.UTF8.GetBytes("Ethereum Signed Message:\n" + abiMessage.Bytes.Length),
                        abiMessage.Bytes)
                    )
                );

            op.Signature = signature;
            op.Hash = UserOperation.CalculateHash(op);
        }
    }
}
