//  Copyright (c) 2021 Demerzel Solutions Limited
//  This file is part of the Nethermind library.
// 
//  The Nethermind library is free software: you can redistribute it and/or modify
//  it under the terms of the GNU Lesser General Public License as published by
//  the Free Software Foundation, either version 3 of the License, or
//  (at your option) any later version.
// 
//  The Nethermind library is distributed in the hope that it will be useful,
//  but WITHOUT ANY WARRANTY; without even the implied warranty of
//  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
//  GNU Lesser General Public License for more details.
// 
//  You should have received a copy of the GNU Lesser General Public License
//  along with the Nethermind. If not, see <http://www.gnu.org/licenses/>.
// 

using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using FluentAssertions;
using Nethermind.Abi;
using Nethermind.AccountAbstraction.Data;
using Nethermind.Consensus;
using Nethermind.Core;
using Nethermind.Core.Crypto;
using Nethermind.Core.Eip2930;
using Nethermind.Core.Extensions;
using Nethermind.Core.Test.Builders;
using Nethermind.Crypto;
using Nethermind.Int256;
using Nethermind.JsonRpc.Data;
using Nethermind.Logging;
using NUnit.Framework;

namespace Nethermind.AccountAbstraction.Test
{
    [TestFixture]
    public partial class AccountAbstractionRpcModuleTests
    {
        public static class Contracts
        {
            public static string SingletonCode = "0x608060405234801561001057600080fd5b50613a9e806100206000396000f3fe6080604052600436106100a05760003560e01c80637ae22593116100645780637ae22593146101985780639e7ba2fa146101d5578063c17824ad146101fe578063c23a5cea14610227578063c345315314610250578063fc68652d1461028d576100a7565b806316934fc4146100ac57806334881e3d146100eb5780634a1ce599146101285780635a627dbc14610151578063739b89501461015b576100a7565b366100a757005b600080fd5b3480156100b857600080fd5b506100d360048036038101906100ce91906121f8565b6102b6565b6040516100e293929190612e5e565b60405180910390f35b3480156100f757600080fd5b50610112600480360381019061010d919061232c565b610324565b60405161011f9190612bc8565b60405180910390f35b34801561013457600080fd5b5061014f600480360381019061014a91906121f8565b610390565b005b610159610544565b005b34801561016757600080fd5b50610182600480360381019061017d9190612252565b6107b0565b60405161018f9190612c4a565b60405180910390f35b3480156101a457600080fd5b506101bf60048036038101906101ba9190612440565b6108da565b6040516101cc9190612e95565b60405180910390f35b3480156101e157600080fd5b506101fc60048036038101906101f7919061229f565b610a5f565b005b34801561020a57600080fd5b506102256004803603810190610220919061239b565b610e4e565b005b34801561023357600080fd5b5061024e60048036038101906102499190612225565b610ecd565b005b34801561025c57600080fd5b50610277600480360381019061027291906121f8565b6110e4565b6040516102849190612dba565b60405180910390f35b34801561029957600080fd5b506102b460048036038101906102af91906123e4565b6111ea565b005b60006020528060005260406000206000915090508060000160009054906101000a90046dffffffffffffffffffffffffffff169080600001600e9054906101000a90046dffffffffffffffffffffffffffff169080600001601c9054906101000a900463ffffffff16905083565b60008060ff60f81b30858786604051602001610341929190612ba0565b6040516020818303038152906040528051906020012060405160200161036a9493929190612b0f565b6040516020818303038152906040528051906020012090508060001c9150509392505050565b60008060008373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000209050600081600001601c9054906101000a900463ffffffff1663ffffffff161461042f576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161042690612cfa565b60405180910390fd5b600061012c4361043f91906132b4565b90508082600001601c6101000a81548163ffffffff021916908363ffffffff1602179055508160000160009054906101000a90046dffffffffffffffffffffffffffff1682600001600e6101000a8154816dffffffffffffffffffffffffffff02191690836dffffffffffffffffffffffffffff16021790555060008260000160006101000a8154816dffffffffffffffffffffffffffff02191690836dffffffffffffffffffffffffffff1602179055503373ffffffffffffffffffffffffffffffffffffffff167fab3a43860ac8cdb29929ba1a1f556b4decf9617f4811c190010e1672e55839b1826040516105379190613015565b60405180910390a2505050565b6000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600001600e9054906101000a90046dffffffffffffffffffffffffffff166dffffffffffffffffffffffffffff16346000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160009054906101000a90046dffffffffffffffffffffffffffff166dffffffffffffffffffffffffffff16610627919061325e565b610631919061325e565b6000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160006101000a8154816dffffffffffffffffffffffffffff02191690836dffffffffffffffffffffffffffff16021790555060008060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001908152602001600020600001601c6101000a81548163ffffffff021916908363ffffffff1602179055503373ffffffffffffffffffffffffffffffffffffffff167f7c717985ac273e663b7f3050f5b15a4388ff6ed952338954f650e2093e13937f6000803373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160009054906101000a90046dffffffffffffffffffffffffffff166040516107a69190612e43565b60405180910390a2565b60608282905067ffffffffffffffff8111156107cf576107ce61369b565b5b6040519080825280602002602001820160405280156107fd5781602001602082028036833780820191505090505b50905060005b838390508110156108d3576000808585848181106108245761082361366c565b5b905060200201602081019061083991906121f8565b73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160009054906101000a90046dffffffffffffffffffffffffffff166dffffffffffffffffffffffffffff168282815181106108b4576108b361366c565b5b60200260200101818152505080806108cb90613583565b915050610803565b5092915050565b60003073ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461091457600080fd5b60005a905060008087600001602081019061092f91906121f8565b73ffffffffffffffffffffffffffffffffffffffff1688608001602081019061095891906124f0565b67ffffffffffffffff168980606001906109729190613030565b604051610980929190612b5d565b60006040518083038160008787f1925050503d80600081146109be576040519150601f19603f3d011682016040523d82523d6000602084013e6109c3565b606091505b5091509150811580156109d7575060008151115b15610a14577f4744f445624b2fc392c793c67e1668a611f72a9cb69867656f9915f2463d69b681604051610a0b9190612c6c565b60405180910390a15b600082610a22576001610a25565b60005b90506000875a86610a36919061337c565b610a40919061325e565b9050610a50828b8b848b89611366565b95505050505050949350505050565b6000479050600084849050905060008167ffffffffffffffff811115610a8857610a8761369b565b5b604051908082528060200260200182016040528015610ab65781602001602082028036833780820191505090505b50905060008267ffffffffffffffff811115610ad557610ad461369b565b5b604051908082528060200260200182016040528015610b035781602001602082028036833780820191505090505b50905060008367ffffffffffffffff811115610b2257610b2161369b565b5b604051908082528060200260200182016040528015610b505781602001602082028036833780820191505090505b5090506000483a610b61919061337c565b905060005b85811015610c2d57368a8a83818110610b8257610b8161366c565b5b9050602002810190610b949190613093565b9050610ba08184611696565b60005a9050610baf83836116f9565b868581518110610bc257610bc161366c565b5b60200260200101888681518110610bdc57610bdb61366c565b5b60200260200101828152508281525050505a81610bf9919061337c565b878481518110610c0c57610c0b61366c565b5b60200260200101818152505050508080610c2590613583565b915050610b66565b506000805b8a8a9050811015610dde5760005a9050368c8c84818110610c5657610c5561366c565b5b9050602002810190610c689190613093565b90506000878481518110610c7f57610c7e61366c565b5b6020026020010151905060003073ffffffffffffffffffffffffffffffffffffffff16637ae2259384848d8981518110610cbc57610cbb61366c565b5b60200260200101518c8a81518110610cd757610cd661366c565b5b60200260200101516040518563ffffffff1660e01b8152600401610cfe9493929190612df7565b602060405180830381600087803b158015610d1857600080fd5b505af1925050508015610d4957506040513d601f19601f82011682018060405250810190610d4691906124c3565b60015b610db45760008a8681518110610d6257610d6161366c565b5b60200260200101515a86610d76919061337c565b610d80919061325e565b9050610dac60028585848d8b81518110610d9d57610d9c61366c565b5b60200260200101516000611366565b915050610db9565b809150505b8086610dc5919061325e565b9550505050508080610dd690613583565b915050610c32565b506000818847610dee919061337c565b610df8919061325e565b90508873ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050158015610e40573d6000803e3d6000fd5b505050505050505050505050565b600073ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614610ebd576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610eb490612cda565b60405180910390fd5b610ec86000826116f9565b505050565b60008060003373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000209050600081600001600e9054906101000a90046dffffffffffffffffffffffffffff166dffffffffffffffffffffffffffff1611610f80576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610f7790612d3a565b60405180910390fd5b4381600001601c9054906101000a900463ffffffff1663ffffffff161115610fdd576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610fd490612d1a565b60405180910390fd5b600081600001600e9054906101000a90046dffffffffffffffffffffffffffff166dffffffffffffffffffffffffffff169050600082600001600e6101000a8154816dffffffffffffffffffffffffffff02191690836dffffffffffffffffffffffffffff1602179055508273ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f1935050505015801561108e573d6000803e3d6000fd5b503373ffffffffffffffffffffffffffffffffffffffff167fb7c918e0e249f999e965cafeb6c664271b3f4317d296461500e71da39f0cbda384836040516110d7929190612be3565b60405180910390a2505050565b6110ec611e6c565b6000808373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020019081526020016000206040518060600160405290816000820160009054906101000a90046dffffffffffffffffffffffffffff166dffffffffffffffffffffffffffff166dffffffffffffffffffffffffffff16815260200160008201600e9054906101000a90046dffffffffffffffffffffffffffff166dffffffffffffffffffffffffffff166dffffffffffffffffffffffffffff16815260200160008201601c9054906101000a900463ffffffff1663ffffffff1663ffffffff16815250509050919050565b60004790506000483a6111fd919061337c565b90506112098482611696565b60005a905060008061121c6000886116f9565b9150915060005a8461122e919061337c565b905060003073ffffffffffffffffffffffffffffffffffffffff16637ae225938a8585886040518563ffffffff1660e01b81526004016112719493929190612df7565b602060405180830381600087803b15801561128b57600080fd5b505af19250505080156112bc57506040513d601f19601f820116820180604052508101906112b991906124c3565b60015b6112f3576000825a876112cf919061337c565b6112d9919061325e565b90506112eb60028b8684896000611366565b9150506112f8565b809150505b6000818847611307919061337c565b611311919061325e565b90508873ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050158015611359573d6000803e3d6000fd5b5050505050505050505050565b60008061137287611af3565b905060005a90506000828761138791906132ee565b905061139b89611396906134b5565b611b52565b6113ff5760008960000160208101906113b491906121f8565b73ffffffffffffffffffffffffffffffffffffffff166108fc83896113d9919061337c565b9081150290604051600060405180830381858888f19350505050905060009450506115fb565b6000801b8814611524578861010001602081019061141d91906121f8565b73ffffffffffffffffffffffffffffffffffffffff166346ca982e8b8b8b856040518563ffffffff1660e01b815260040161145b9493929190612c8e565b600060405180830381600087803b15801561147557600080fd5b505af1925050508015611486575060015b611522573d80600081146114b6576040519150601f19603f3d011682016040523d82523d6000602084013e6114bb565b606091505b507f5f6032b8e84e218db7c512ea2e55828c412cfcba5d42b23d21b42f7e7210b8648a6101000160208101906114f191906121f8565b8b600001602081019061150491906121f8565b8360405161151493929190612c0c565b60405180910390a150611523565b5b5b825a83611531919061337c565b61153b91906132ee565b81611546919061325e565b9050806000808b61010001602081019061156091906121f8565b73ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160008282829054906101000a90046dffffffffffffffffffffffffffff166115c59190613348565b92506101000a8154816dffffffffffffffffffffffffffff02191690836dffffffffffffffffffffffffffff1602179055508093505b8861010001602081019061160f91906121f8565b73ffffffffffffffffffffffffffffffffffffffff1689600001602081019061163891906121f8565b73ffffffffffffffffffffffffffffffffffffffff167f87ff8671dda0b81e2f2bec38f9ee39fa8b7c73fa15723e01ea0e39a385981e8f83868960405161168193929190612fde565b60405180910390a35050509695505050505050565b808260e00160208101906116aa91906124f0565b67ffffffffffffffff1611156116f5576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016116ec90612d7a565b60405180910390fd5b5050565b600080600061170784611b90565b9050600047905060005a90508273ffffffffffffffffffffffffffffffffffffffff1663d68a7a6d8760a00135886040518363ffffffff1660e01b81526004016117519190612dd5565b600060405180830381600088803b15801561176b57600080fd5b5087f19350505050801561177d575060015b61182b576117896136ca565b806308c379a014156117ea575061179e61394b565b806117a957506117ec565b876000826040517efa072b0000000000000000000000000000000000000000000000000000000081526004016117e193929190612eb0565b60405180910390fd5b505b8660006040517efa072b000000000000000000000000000000000000000000000000000000008152600401611822929190612f66565b60405180910390fd5b60005a82611839919061337c565b90508247611847919061337c565b955061185b87611856906134b5565b611b52565b6118c2576118718761186c906134b5565b611d07565b8610156118b7578760006040517efa072b0000000000000000000000000000000000000000000000000000000081526004016118ae929190612eee565b60405180910390fd5b6000801b9450611ae8565b60008614611909578760006040517efa072b000000000000000000000000000000000000000000000000000000008152600401611900929190612f2a565b60405180910390fd5b61191287611d32565b61196757878761010001602081019061192b91906121f8565b6040517efa072b00000000000000000000000000000000000000000000000000000000815260040161195e929190612fa2565b60405180910390fd5b8661010001602081019061197b91906121f8565b73ffffffffffffffffffffffffffffffffffffffff166352d570bd828960a001356119a6919061337c565b896040518363ffffffff1660e01b81526004016119c39190612dd5565b60206040518083038187803b1580156119db57600080fd5b5086fa93505050508015611a0d57506040513d601f19601f82011682018060405250810190611a0a91906122ff565b60015b611adf57611a196136ca565b806308c379a01415611a8c5750611a2e61394b565b80611a395750611a8e565b8888610100016020810190611a4e91906121f8565b826040517efa072b000000000000000000000000000000000000000000000000000000008152600401611a8393929190612eb0565b60405180910390fd5b505b8787610100016020810190611aa391906121f8565b6040517efa072b000000000000000000000000000000000000000000000000000000008152600401611ad6929190612f66565b60405180910390fd5b80955060009650505b505050509250929050565b6000611b4b8260c0016020810190611b0b91906124f0565b67ffffffffffffffff16611b46488560e0016020810190611b2c91906124f0565b67ffffffffffffffff16611b40919061325e565b3a611d7c565b611d7c565b9050919050565b60008073ffffffffffffffffffffffffffffffffffffffff1682610100015173ffffffffffffffffffffffffffffffffffffffff1614159050919050565b6000816000016020810190611ba591906121f8565b90506000828060400190611bb99190613030565b905014611d02576000828060400190611bd29190613030565b84610140016020810190611be691906121f8565b604051602001611bf893929190612b76565b60405160208183030381529060405290506000836020013590506000818351602085016000f59050600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff161415611c90576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611c8790612d9a565b60405180910390fd5b8373ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1614611cfe576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401611cf590612d5a565b60405180910390fd5b5050505b919050565b60008160c0015167ffffffffffffffff16611d2183611d95565b611d2b91906132ee565b9050919050565b6000611d7582610100016020810190611d4b91906121f8565b611d5d84611d58906134b5565b611d07565b670de0b6b3a7640000611d70919061325e565b611df3565b9050919050565b6000818310611d8b5781611d8d565b825b905092915050565b600080826080015167ffffffffffffffff16905060008360400151511115611dea57600083606001515160c8611dcb91906132ee565b617d00611dd8919061325e565b90508082611de6919061325e565b9150505b80915050919050565b6000816000808573ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200190815260200160002060000160009054906101000a90046dffffffffffffffffffffffffffff166dffffffffffffffffffffffffffff161015905092915050565b604051806060016040528060006dffffffffffffffffffffffffffff16815260200160006dffffffffffffffffffffffffffff168152602001600063ffffffff1681525090565b6000611ec6611ec1846130e1565b6130bc565b905082815260208101848484011115611ee257611ee1613723565b5b611eed848285613510565b509392505050565b600081359050611f04816139f5565b92915050565b600081359050611f1981613a0c565b92915050565b60008083601f840112611f3557611f346136f6565b5b8235905067ffffffffffffffff811115611f5257611f516136f1565b5b602083019150836020820283011115611f6e57611f6d613719565b5b9250929050565b60008083601f840112611f8b57611f8a6136f6565b5b8235905067ffffffffffffffff811115611fa857611fa76136f1565b5b602083019150836020820283011115611fc457611fc3613719565b5b9250929050565b600081359050611fda81613a23565b92915050565b600081519050611fef81613a23565b92915050565b600082601f83011261200a576120096136f6565b5b813561201a848260208601611eb3565b91505092915050565b6000610180828403121561203a57612039613700565b5b81905092915050565b6000610180828403121561205a57612059613705565b5b6120656101806130bc565b9050600061207584828501611ef5565b6000830152506020612089848285016121b9565b602083015250604082013567ffffffffffffffff8111156120ad576120ac613714565b5b6120b984828501611ff5565b604083015250606082013567ffffffffffffffff8111156120dd576120dc613714565b5b6120e984828501611ff5565b60608301525060806120fd848285016121e3565b60808301525060a0612111848285016121b9565b60a08301525060c0612125848285016121e3565b60c08301525060e0612139848285016121e3565b60e08301525061010061214e84828501611ef5565b6101008301525061012061216484828501611fcb565b6101208301525061014061217a84828501611ef5565b6101408301525061016082013567ffffffffffffffff8111156121a05761219f613714565b5b6121ac84828501611ff5565b6101608301525092915050565b6000813590506121c881613a3a565b92915050565b6000815190506121dd81613a3a565b92915050565b6000813590506121f281613a51565b92915050565b60006020828403121561220e5761220d613732565b5b600061221c84828501611ef5565b91505092915050565b60006020828403121561223b5761223a613732565b5b600061224984828501611f0a565b91505092915050565b6000806020838503121561226957612268613732565b5b600083013567ffffffffffffffff81111561228757612286613728565b5b61229385828601611f1f565b92509250509250929050565b6000806000604084860312156122b8576122b7613732565b5b600084013567ffffffffffffffff8111156122d6576122d5613728565b5b6122e286828701611f75565b935093505060206122f586828701611f0a565b9150509250925092565b60006020828403121561231557612314613732565b5b600061232384828501611fe0565b91505092915050565b60008060006060848603121561234557612344613732565b5b600084013567ffffffffffffffff81111561236357612362613728565b5b61236f86828701611ff5565b9350506020612380868287016121b9565b925050604061239186828701611ef5565b9150509250925092565b6000602082840312156123b1576123b0613732565b5b600082013567ffffffffffffffff8111156123cf576123ce613728565b5b6123db84828501612023565b91505092915050565b600080604083850312156123fb576123fa613732565b5b600083013567ffffffffffffffff81111561241957612418613728565b5b61242585828601612023565b925050602061243685828601611f0a565b9150509250929050565b6000806000806080858703121561245a57612459613732565b5b600085013567ffffffffffffffff81111561247857612477613728565b5b61248487828801612023565b945050602061249587828801611fcb565b93505060406124a6878288016121b9565b92505060606124b7878288016121b9565b91505092959194509250565b6000602082840312156124d9576124d8613732565b5b60006124e7848285016121ce565b91505092915050565b60006020828403121561250657612505613732565b5b6000612514848285016121e3565b91505092915050565b60006125298383612a9e565b60208301905092915050565b61253e81613491565b82525050565b61254d816133b0565b82525050565b61255c816133b0565b82525050565b61257361256e826133b0565b6135cc565b82525050565b600061258482613122565b61258e8185613150565b935061259983613112565b8060005b838110156125ca5781516125b1888261251d565b97506125bc83613143565b92505060018101905061259d565b5085935050505092915050565b6125e0816133d4565b82525050565b6125f76125f2826133e0565b6135de565b82525050565b6126068161340c565b82525050565b6126158161340c565b82525050565b61262c6126278261340c565b6135e8565b82525050565b600061263e8385613161565b935061264b838584613510565b61265483613737565b840190509392505050565b600061266b8385613183565b9350612678838584613510565b82840190509392505050565b600061268f8261312d565b6126998185613172565b93506126a981856020860161351f565b6126b281613737565b840191505092915050565b60006126c88261312d565b6126d28185613183565b93506126e281856020860161351f565b80840191505092915050565b6126f7816134a3565b82525050565b600061270882613138565b612712818561318e565b935061272281856020860161351f565b61272b81613737565b840191505092915050565b6000612743602c8361318e565b915061274e82613762565b604082019050919050565b6000612766600f8361318e565b9150612771826137b1565b602082019050919050565b600061278960158361318e565b9150612794826137da565b602082019050919050565b60006127ac60118361318e565b91506127b782613803565b602082019050919050565b60006127cf60248361318e565b91506127da8261382c565b604082019050919050565b60006127f260198361318e565b91506127fd8261387b565b602082019050919050565b6000612815601d8361318e565b9150612820826138a4565b602082019050919050565b6000612838601a8361318e565b9150612843826138cd565b602082019050919050565b600061285b600e8361318e565b9150612866826138f6565b602082019050919050565b600061287e60008361318e565b91506128898261391f565b600082019050919050565b60006128a160108361318e565b91506128ac82613922565b602082019050919050565b6060820160008201516128cd6000850182612a71565b5060208201516128e06020850182612a71565b5060408201516128f36040850182612ae2565b50505050565b6000610180830161290d600084018461319f565b61291a6000860182612544565b506129286020840184613230565b6129356020860182612a9e565b5061294360408401846131cd565b8583036040870152612956838284612632565b9250505061296760608401846131cd565b858303606087015261297a838284612632565b9250505061298b6080840184613247565b6129986080860182612b00565b506129a660a0840184613230565b6129b360a0860182612a9e565b506129c160c0840184613247565b6129ce60c0860182612b00565b506129dc60e0840184613247565b6129e960e0860182612b00565b506129f861010084018461319f565b612a06610100860182612544565b50612a156101208401846131b6565b612a236101208601826125fd565b50612a3261014084018461319f565b612a40610140860182612544565b50612a4f6101608401846131cd565b858303610160870152612a63838284612632565b925050508091505092915050565b612a7a81613429565b82525050565b612a8981613429565b82525050565b612a98816134c8565b82525050565b612aa781613463565b82525050565b612ab681613463565b82525050565b612acd612ac882613463565b613604565b82525050565b612adc816134fe565b82525050565b612aeb8161346d565b82525050565b612afa8161346d565b82525050565b612b098161347d565b82525050565b6000612b1b82876125e6565b600182019150612b2b8286612562565b601482019150612b3b8285612abc565b602082019150612b4b828461261b565b60208201915081905095945050505050565b6000612b6a82848661265f565b91508190509392505050565b6000612b8382858761265f565b9150612b8f8284612562565b601482019150819050949350505050565b6000612bac82856126bd565b9150612bb88284612562565b6014820191508190509392505050565b6000602082019050612bdd6000830184612553565b92915050565b6000604082019050612bf86000830185612535565b612c056020830184612aad565b9392505050565b6000606082019050612c216000830186612553565b612c2e6020830185612553565b8181036040830152612c408184612684565b9050949350505050565b60006020820190508181036000830152612c648184612579565b905092915050565b60006020820190508181036000830152612c868184612684565b905092915050565b6000608082019050612ca360008301876126ee565b8181036020830152612cb581866128f9565b9050612cc4604083018561260c565b612cd16060830184612aad565b95945050505050565b60006020820190508181036000830152612cf381612736565b9050919050565b60006020820190508181036000830152612d1381612759565b9050919050565b60006020820190508181036000830152612d338161277c565b9050919050565b60006020820190508181036000830152612d538161279f565b9050919050565b60006020820190508181036000830152612d73816127c2565b9050919050565b60006020820190508181036000830152612d938161282b565b9050919050565b60006020820190508181036000830152612db38161284e565b9050919050565b6000606082019050612dcf60008301846128b7565b92915050565b60006020820190508181036000830152612def81846128f9565b905092915050565b60006080820190508181036000830152612e1181876128f9565b9050612e20602083018661260c565b612e2d6040830185612aad565b612e3a6060830184612aad565b95945050505050565b6000602082019050612e586000830184612a8f565b92915050565b6000606082019050612e736000830186612a80565b612e806020830185612a80565b612e8d6040830184612af1565b949350505050565b6000602082019050612eaa6000830184612aad565b92915050565b6000606082019050612ec56000830186612aad565b612ed26020830185612553565b8181036040830152612ee481846126fd565b9050949350505050565b6000606082019050612f036000830185612aad565b612f106020830184612553565b8181036040830152612f21816127e5565b90509392505050565b6000606082019050612f3f6000830185612aad565b612f4c6020830184612553565b8181036040830152612f5d81612808565b90509392505050565b6000606082019050612f7b6000830185612aad565b612f886020830184612553565b8181036040830152612f9981612871565b90509392505050565b6000606082019050612fb76000830185612aad565b612fc46020830184612553565b8181036040830152612fd581612894565b90509392505050565b6000606082019050612ff36000830186612aad565b6130006020830185612aad565b61300d60408301846125d7565b949350505050565b600060208201905061302a6000830184612ad3565b92915050565b6000808335600160200384360303811261304d5761304c61370a565b5b80840192508235915067ffffffffffffffff82111561306f5761306e6136fb565b5b60208301925060018202360383131561308b5761308a61371e565b5b509250929050565b600082356001610180038336030381126130b0576130af61370a565b5b80830191505092915050565b60006130c66130d7565b90506130d28282613552565b919050565b6000604051905090565b600067ffffffffffffffff8211156130fc576130fb61369b565b5b61310582613737565b9050602081019050919050565b6000819050602082019050919050565b600081519050919050565b600081519050919050565b600081519050919050565b6000602082019050919050565b600082825260208201905092915050565b600082825260208201905092915050565b600082825260208201905092915050565b600081905092915050565b600082825260208201905092915050565b60006131ae6020840184611ef5565b905092915050565b60006131c56020840184611fcb565b905092915050565b600080833560016020038436030381126131ea576131e961372d565b5b83810192508235915060208301925067ffffffffffffffff821115613212576132116136ec565b5b6001820236038413156132285761322761370f565b5b509250929050565b600061323f60208401846121b9565b905092915050565b600061325660208401846121e3565b905092915050565b600061326982613463565b915061327483613463565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff038211156132a9576132a861360e565b5b828201905092915050565b60006132bf8261346d565b91506132ca8361346d565b92508263ffffffff038211156132e3576132e261360e565b5b828201905092915050565b60006132f982613463565b915061330483613463565b9250817fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff048311821515161561333d5761333c61360e565b5b828202905092915050565b600061335382613429565b915061335e83613429565b9250828210156133715761337061360e565b5b828203905092915050565b600061338782613463565b915061339283613463565b9250828210156133a5576133a461360e565b5b828203905092915050565b60006133bb82613443565b9050919050565b60006133cd82613443565b9050919050565b60008115159050919050565b60007fff0000000000000000000000000000000000000000000000000000000000000082169050919050565b6000819050919050565b6000819050613424826139e1565b919050565b60006dffffffffffffffffffffffffffff82169050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b600063ffffffff82169050919050565b600067ffffffffffffffff82169050919050565b600061349c826134da565b9050919050565b60006134ae82613416565b9050919050565b60006134c13683612043565b9050919050565b60006134d382613429565b9050919050565b60006134e5826134ec565b9050919050565b60006134f782613443565b9050919050565b60006135098261346d565b9050919050565b82818337600083830152505050565b60005b8381101561353d578082015181840152602081019050613522565b8381111561354c576000848401525b50505050565b61355b82613737565b810181811067ffffffffffffffff8211171561357a5761357961369b565b5b80604052505050565b600061358e82613463565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff8214156135c1576135c061360e565b5b600182019050919050565b60006135d7826135f2565b9050919050565b6000819050919050565b6000819050919050565b60006135fd82613748565b9050919050565b6000819050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052602160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b600060033d11156136e95760046000803e6136e6600051613755565b90505b90565b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b60008160601b9050919050565b60008160e01c9050919050565b7f6d7573742062652063616c6c6564206f66662d636861696e207769746820667260008201527f6f6d3d7a65726f2d616464720000000000000000000000000000000000000000602082015250565b7f616c72656164792070656e64696e670000000000000000000000000000000000600082015250565b7f5769746864726177616c206973206e6f74206475650000000000000000000000600082015250565b7f6e6f20756e6c6f636b6564207374616b65000000000000000000000000000000600082015250565b7f74617267657420646f65736e2774206d6174636820637265617465322061646460008201527f7265737300000000000000000000000000000000000000000000000000000000602082015250565b7f77616c6c6574206469646e2774207061792070726566756e6400000000000000600082015250565b7f686173207061796d6173746572206275742077616c6c65742070616964000000600082015250565b7f61637475616c207072696f7269747946656520746f6f206c6f77000000000000600082015250565b7f63726561746532206661696c6564000000000000000000000000000000000000600082015250565b50565b7f6e6f7420656e6f756768207374616b6500000000000000000000000000000000600082015250565b600060443d101561395b576139de565b6139636130d7565b60043d036004823e80513d602482011167ffffffffffffffff8211171561398b5750506139de565b808201805167ffffffffffffffff8111156139a957505050506139de565b80602083010160043d0385018111156139c65750505050506139de565b6139d582602001850186613552565b82955050505050505b90565b600381106139f2576139f161363d565b5b50565b6139fe816133b0565b8114613a0957600080fd5b50565b613a15816133c2565b8114613a2057600080fd5b50565b613a2c8161340c565b8114613a3757600080fd5b50565b613a4381613463565b8114613a4e57600080fd5b50565b613a5a8161347d565b8114613a6557600080fd5b5056fea2646970667358221220efdc351c3517f3374c90d6016a4fb23d8ea9f87be0c06eaa81e747ae16c11fdb64736f6c63430008070033";
            public static string SimpleWalletCode = "0x608060405234801561001057600080fd5b50611f38806100206000396000f3fe6080604052600436106100955760003560e01c8063be6002c211610059578063be6002c214610174578063c02a6bd51461019d578063d45109f4146101c6578063d68a7a6d146101ef578063f09a4016146102185761009c565b806341ed0e59146100a15780638da5cb5b146100ca578063a9059cbb146100f5578063affed0e01461011e578063b62654fb146101495761009c565b3661009c57005b600080fd5b3480156100ad57600080fd5b506100c860048036038101906100c39190611164565b610241565b005b3480156100d657600080fd5b506100df6102e8565b6040516100ec919061161a565b60405180910390f35b34801561010157600080fd5b5061011c60048036038101906101179190611191565b61030e565b005b34801561012a57600080fd5b50610133610361565b604051610140919061188d565b60405180910390f35b34801561015557600080fd5b5061015e610367565b60405161016b919061161a565b60405180910390f35b34801561018057600080fd5b5061019b60048036038101906101969190611264565b61038d565b005b3480156101a957600080fd5b506101c460048036038101906101bf91906111d1565b610414565b005b3480156101d257600080fd5b506101ed60048036038101906101e89190611304565b610532565b005b3480156101fb57600080fd5b5061021660048036038101906102119190611351565b61060a565b005b34801561022457600080fd5b5061023f600480360381019061023a9190611224565b610793565b005b61024961091a565b7fbf7405b81de3cf3dde24b3ee97cd49371cee922e21a8a7960dfe8e31a0ef9425600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff168260405161029c929190611635565b60405180910390a180600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b61031661091a565b8173ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f1935050505015801561035c573d6000803e3d6000fd5b505050565b60005481565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b61039561091a565b60008373ffffffffffffffffffffffffffffffffffffffff1683836040516103be9291906115db565b6000604051808303816000865af19150503d80600081146103fb576040519150601f19603f3d011682016040523d82523d6000602084013e610400565b606091505b505090508061040e57600080fd5b50505050565b600073ffffffffffffffffffffffffffffffffffffffff16600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16146104a5576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161049c9061180d565b60405180910390fd5b80600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508273ffffffffffffffffffffffffffffffffffffffff166108fc839081150290604051600060405180830381858888f1935050505015801561052c573d6000803e3d6000fd5b50505050565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461058c57600080fd5b60003073ffffffffffffffffffffffffffffffffffffffff1683836040516105b59291906115db565b6000604051808303816000865af19150503d80600081146105f2576040519150601f19603f3d011682016040523d82523d6000602084013e6105f7565b606091505b505090508061060557600080fd5b505050565b600073ffffffffffffffffffffffffffffffffffffffff16600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614806106b45750600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b6106f3576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016106ea906117cd565b60405180910390fd5b6106fc81610a04565b61070581610c9a565b600061071082610cf8565b90506000811461078f573373ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f1935050505061078e576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016107859061184d565b60405180910390fd5b5b5050565b600073ffffffffffffffffffffffffffffffffffffffff16600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614610824576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161081b9061186d565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415610894576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161088b9061176d565b60405180910390fd5b81600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555080600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505050565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614806109c35750600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b610a02576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016109f9906117ad565b60405180910390fd5b565b600073ffffffffffffffffffffffffffffffffffffffff16600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161480610ac1575080610140016020810190610a709190611164565b73ffffffffffffffffffffffffffffffffffffffff16600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16145b610b00576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610af79061182d565b60405180910390fd5b6000610b1482610b0f90611acd565b610d34565b9050604182806101600190610b2991906118a8565b905014610b6b576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610b629061174d565b60405180910390fd5b60008083806101600190610b7f91906118a8565b810190610b8c91906112c4565b91509150600084806101600190610ba391906118a8565b6040818110610bb557610bb4611bd5565b5b9050013560f81c60f81b60f81c905060018482858560405160008152602001604052604051610be79493929190611708565b6020604051602081039080840390855afa158015610c09573d6000803e3d6000fd5b5050506020604051035173ffffffffffffffffffffffffffffffffffffffff1685610140016020810190610c3d9190611164565b73ffffffffffffffffffffffffffffffffffffffff1614610c93576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610c8a9061178d565b60405180910390fd5b5050505050565b8060200135600080815480929190610cb190611b53565b9190505514610cf5576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610cec906117ed565b60405180910390fd5b50565b6000610d0c82610d0790611acd565b610d73565b15610d1a5760009050610d2f565b610d2c82610d2790611acd565b610db1565b90505b919050565b6000610d3f82610ddc565b80519060200120604051602001610d5691906115f4565b604051602081830303815290604052805190602001209050919050565b60008073ffffffffffffffffffffffffffffffffffffffff1682610100015173ffffffffffffffffffffffffffffffffffffffff1614159050919050565b60008160c0015167ffffffffffffffff16610dcb83610e41565b610dd591906119fa565b9050919050565b6060816000015182602001518360400151846060015185608001518660a001518760c001518860e001518961010001518a6101200151604051602001610e2b9a9998979695949392919061165e565b6040516020818303038152906040529050919050565b600080826080015167ffffffffffffffff16905060008360400151511115610e9657600083606001515160c8610e7791906119fa565b617d00610e8491906119a4565b90508082610e9291906119a4565b9150505b80915050919050565b6000610eb2610ead84611930565b61190b565b905082815260208101848484011115610ece57610ecd611c60565b5b610ed9848285611ae0565b509392505050565b600081359050610ef081611e8f565b92915050565b600081359050610f0581611ea6565b92915050565b600081359050610f1a81611ebd565b92915050565b60008083601f840112610f3657610f35611c38565b5b8235905067ffffffffffffffff811115610f5357610f52611c33565b5b602083019150836001820283011115610f6f57610f6e611c56565b5b9250929050565b600082601f830112610f8b57610f8a611c38565b5b8135610f9b848260208601610e9f565b91505092915050565b60006101808284031215610fbb57610fba611c42565b5b81905092915050565b60006101808284031215610fdb57610fda611c47565b5b610fe661018061190b565b90506000610ff684828501610ee1565b600083015250602061100a8482850161113a565b602083015250604082013567ffffffffffffffff81111561102e5761102d611c51565b5b61103a84828501610f76565b604083015250606082013567ffffffffffffffff81111561105e5761105d611c51565b5b61106a84828501610f76565b606083015250608061107e8482850161114f565b60808301525060a06110928482850161113a565b60a08301525060c06110a68482850161114f565b60c08301525060e06110ba8482850161114f565b60e0830152506101006110cf84828501610ee1565b610100830152506101206110e584828501610f0b565b610120830152506101406110fb84828501610ee1565b6101408301525061016082013567ffffffffffffffff81111561112157611120611c51565b5b61112d84828501610f76565b6101608301525092915050565b60008135905061114981611ed4565b92915050565b60008135905061115e81611eeb565b92915050565b60006020828403121561117a57611179611c6a565b5b600061118884828501610ee1565b91505092915050565b600080604083850312156111a8576111a7611c6a565b5b60006111b685828601610ef6565b92505060206111c78582860161113a565b9150509250929050565b6000806000606084860312156111ea576111e9611c6a565b5b60006111f886828701610ef6565b93505060206112098682870161113a565b925050604061121a86828701610ee1565b9150509250925092565b6000806040838503121561123b5761123a611c6a565b5b600061124985828601610ee1565b925050602061125a85828601610ee1565b9150509250929050565b60008060006040848603121561127d5761127c611c6a565b5b600061128b86828701610ee1565b935050602084013567ffffffffffffffff8111156112ac576112ab611c65565b5b6112b886828701610f20565b92509250509250925092565b600080604083850312156112db576112da611c6a565b5b60006112e985828601610f0b565b92505060206112fa85828601610f0b565b9150509250929050565b6000806020838503121561131b5761131a611c6a565b5b600083013567ffffffffffffffff81111561133957611338611c65565b5b61134585828601610f20565b92509250509250929050565b60006020828403121561136757611366611c6a565b5b600082013567ffffffffffffffff81111561138557611384611c65565b5b61139184828501610fa4565b91505092915050565b6113a381611a54565b82525050565b6113b281611a78565b82525050565b6113c96113c482611a78565b611b9c565b82525050565b60006113db838561197d565b93506113e8838584611ae0565b82840190509392505050565b60006113ff82611961565b611409818561196c565b9350611419818560208601611aef565b61142281611c6f565b840191505092915050565b600061143a601c83611999565b915061144582611c80565b601c82019050919050565b600061145d602083611988565b915061146882611ca9565b602082019050919050565b6000611480602283611988565b915061148b82611cd2565b604082019050919050565b60006114a3601783611988565b91506114ae82611d21565b602082019050919050565b60006114c6602783611988565b91506114d182611d4a565b604082019050919050565b60006114e9601a83611988565b91506114f482611d99565b602082019050919050565b600061150c601583611988565b915061151782611dc2565b602082019050919050565b600061152f601583611988565b915061153a82611deb565b602082019050919050565b6000611552601183611988565b915061155d82611e14565b602082019050919050565b6000611575601083611988565b915061158082611e3d565b602082019050919050565b6000611598601b83611988565b91506115a382611e66565b602082019050919050565b6115b781611aa2565b82525050565b6115c681611aac565b82525050565b6115d581611ac0565b82525050565b60006115e88284866113cf565b91508190509392505050565b60006115ff8261142d565b915061160b82846113b8565b60208201915081905092915050565b600060208201905061162f600083018461139a565b92915050565b600060408201905061164a600083018561139a565b611657602083018461139a565b9392505050565b600061014082019050611674600083018d61139a565b611681602083018c6115ae565b8181036040830152611693818b6113f4565b905081810360608301526116a7818a6113f4565b90506116b660808301896115bd565b6116c360a08301886115ae565b6116d060c08301876115bd565b6116dd60e08301866115bd565b6116eb61010083018561139a565b6116f96101208301846113a9565b9b9a5050505050505050505050565b600060808201905061171d60008301876113a9565b61172a60208301866115cc565b61173760408301856113a9565b61174460608301846113a9565b95945050505050565b6000602082019050818103600083015261176681611450565b9050919050565b6000602082019050818103600083015261178681611473565b9050919050565b600060208201905081810360008301526117a681611496565b9050919050565b600060208201905081810360008301526117c6816114b9565b9050919050565b600060208201905081810360008301526117e6816114dc565b9050919050565b60006020820190508181036000830152611806816114ff565b9050919050565b6000602082019050818103600083015261182681611522565b9050919050565b6000602082019050818103600083015261184681611545565b9050919050565b6000602082019050818103600083015261186681611568565b9050919050565b600060208201905081810360008301526118868161158b565b9050919050565b60006020820190506118a260008301846115ae565b92915050565b600080833560016020038436030381126118c5576118c4611c4c565b5b80840192508235915067ffffffffffffffff8211156118e7576118e6611c3d565b5b60208301925060018202360383131561190357611902611c5b565b5b509250929050565b6000611915611926565b90506119218282611b22565b919050565b6000604051905090565b600067ffffffffffffffff82111561194b5761194a611c04565b5b61195482611c6f565b9050602081019050919050565b600081519050919050565b600082825260208201905092915050565b600081905092915050565b600082825260208201905092915050565b600081905092915050565b60006119af82611aa2565b91506119ba83611aa2565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff038211156119ef576119ee611ba6565b5b828201905092915050565b6000611a0582611aa2565b9150611a1083611aa2565b9250817fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0483118215151615611a4957611a48611ba6565b5b828202905092915050565b6000611a5f82611a82565b9050919050565b6000611a7182611a82565b9050919050565b6000819050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b600067ffffffffffffffff82169050919050565b600060ff82169050919050565b6000611ad93683610fc4565b9050919050565b82818337600083830152505050565b60005b83811015611b0d578082015181840152602081019050611af2565b83811115611b1c576000848401525b50505050565b611b2b82611c6f565b810181811067ffffffffffffffff82111715611b4a57611b49611c04565b5b80604052505050565b6000611b5e82611aa2565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff821415611b9157611b90611ba6565b5b600182019050919050565b6000819050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f19457468657265756d205369676e6564204d6573736167653a0a333200000000600082015250565b7f77616c6c65743a20696e76616c6964207369676e6174757265206c656e677468600082015250565b7f77616c6c65743a2063616e6e6f742068617665206e756c6c2073696e676c657460008201527f6f6e000000000000000000000000000000000000000000000000000000000000602082015250565b7f77616c6c65743a2077726f6e67207369676e6174757265000000000000000000600082015250565b7f77616c6c65743a206f6e6c79207468726f7567682073696e676c65746f6e206f60008201527f72206f776e657200000000000000000000000000000000000000000000000000602082015250565b7f77616c6c65743a206e6f742066726f6d2053696e676c65746f6e000000000000600082015250565b7f77616c6c65743a20696e76616c6964206e6f6e63650000000000000000000000600082015250565b7f73696e676c65746f6e20616c7265616479207365740000000000000000000000600082015250565b7f77616c6c65743a206e6f74206f776e6572000000000000000000000000000000600082015250565b7f6661696c656420746f2070726570617900000000000000000000000000000000600082015250565b7f77616c6c65743a20616c726561647920696e697469616c697a65640000000000600082015250565b611e9881611a54565b8114611ea357600080fd5b50565b611eaf81611a66565b8114611eba57600080fd5b50565b611ec681611a78565b8114611ed157600080fd5b50565b611edd81611aa2565b8114611ee857600080fd5b50565b611ef481611aac565b8114611eff57600080fd5b5056fea264697066735822122090faee18e339340d2b505e680e09393b8c5553e94d005e69cb7d79bf19df35e564736f6c63430008070033";
            public static string SimplePaymasterCode = "0x6080604052610bb86001553480156200001757600080fd5b5060405162003ccd38038062003ccd83398181016040528101906200003d919062000247565b6200005d620000516200013f60201b60201c565b6200014760201b60201c565b81600360006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555080600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555060016004600060405180602001620000f7906200020b565b6020820181038252601f19601f8201166040525080519060200120815260200190815260200160002060006101000a81548160ff021916908315150217905550505062000337565b600033905090565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050816000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b61217d8062001b5083390190565b6000815190506200022a8162000303565b92915050565b60008151905062000241816200031d565b92915050565b60008060408385031215620002615762000260620002fe565b5b6000620002718582860162000230565b9250506020620002848582860162000219565b9150509250929050565b60006200029b82620002de565b9050919050565b6000620002af82620002de565b9050919050565b6000620002c3826200028e565b9050919050565b6000620002d782620002a2565b9050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b600080fd5b6200030e81620002b6565b81146200031a57600080fd5b50565b6200032881620002ca565b81146200033457600080fd5b50565b61180980620003476000396000f3fe60806040526004361061007b5760003560e01c8063715018a61161004e578063715018a6146101195780638da5cb5b14610130578063b158094c1461015b578063f2fde38b146101985761007b565b806306b091f91461008057806346ca982e146100a957806352d570bd146100d25780635a627dbc1461010f575b600080fd5b34801561008c57600080fd5b506100a760048036038101906100a29190610e30565b6101c1565b005b3480156100b557600080fd5b506100d060048036038101906100cb9190610eca565b6102f1565b005b3480156100de57600080fd5b506100f960048036038101906100f49190610f4d565b6103d6565b60405161010691906111ce565b60405180910390f35b6101176107b1565b005b34801561012557600080fd5b5061012e610836565b005b34801561013c57600080fd5b506101456108be565b604051610152919061110f565b60405180910390f35b34801561016757600080fd5b50610182600480360381019061017d9190610e9d565b6108e7565b60405161018f91906111b3565b60405180910390f35b3480156101a457600080fd5b506101bf60048036038101906101ba9190610e03565b610907565b005b6101c96109ff565b73ffffffffffffffffffffffffffffffffffffffff166101e76108be565b73ffffffffffffffffffffffffffffffffffffffff161461023d576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161023490611249565b60405180910390fd5b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663a9059cbb83836040518363ffffffff1660e01b815260040161029a92919061118a565b602060405180830381600087803b1580156102b457600080fd5b505af11580156102c8573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906102ec9190610e70565b505050565b600061030960015483610304919061137e565b610a07565b9050600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166323b872dd85600001602081019061035c9190610e03565b30846040518463ffffffff1660e01b815260040161037c93929190611153565b602060405180830381600087803b15801561039657600080fd5b505af11580156103aa573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906103ce9190610e70565b505050505050565b6000806103f36103ee846103e9906114c5565b610a1d565b610a07565b9050600083806040019061040791906112a9565b9050146105a457600083806040019061042091906112a9565b60405161042e9291906110f6565b604051809103902090506004600082815260200190815260200160002060009054906101000a900460ff16610498576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161048f90611229565b60405180910390fd5b81600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166370a082318660000160208101906104ea9190610e03565b6040518263ffffffff1660e01b8152600401610506919061110f565b60206040518083038186803b15801561051e57600080fd5b505afa158015610532573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906105569190610f96565b11610596576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161058d90611269565b60405180910390fd5b600160001b925050506107ac565b80600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166370a082318560000160208101906105f69190610e03565b6040518263ffffffff1660e01b8152600401610612919061110f565b60206040518083038186803b15801561062a57600080fd5b505afa15801561063e573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906106629190610f96565b116106a2576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161069990611289565b60405180910390fd5b80600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1663dd62ed3e8560000160208101906106f49190610e03565b306040518363ffffffff1660e01b815260040161071292919061112a565b60206040518083038186803b15801561072a57600080fd5b505afa15801561073e573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906107629190610f96565b10156107a3576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161079a90611209565b60405180910390fd5b600160001b9150505b919050565b600360009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16635a627dbc346040518263ffffffff1660e01b81526004016000604051808303818588803b15801561081b57600080fd5b505af115801561082f573d6000803e3d6000fd5b5050505050565b61083e6109ff565b73ffffffffffffffffffffffffffffffffffffffff1661085c6108be565b73ffffffffffffffffffffffffffffffffffffffff16146108b2576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016108a990611249565b60405180910390fd5b6108bc6000610a48565b565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16905090565b60046020528060005260406000206000915054906101000a900460ff1681565b61090f6109ff565b73ffffffffffffffffffffffffffffffffffffffff1661092d6108be565b73ffffffffffffffffffffffffffffffffffffffff1614610983576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161097a90611249565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff1614156109f3576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016109ea906111e9565b60405180910390fd5b6109fc81610a48565b50565b600033905090565b6000606482610a1691906113d4565b9050919050565b60008160c0015167ffffffffffffffff16610a3783610b0c565b610a419190611405565b9050919050565b60008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff169050816000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508173ffffffffffffffffffffffffffffffffffffffff168173ffffffffffffffffffffffffffffffffffffffff167f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e060405160405180910390a35050565b600080826080015167ffffffffffffffff16905060008360400151511115610b6157600083606001515160c8610b429190611405565b617d00610b4f919061137e565b90508082610b5d919061137e565b9150505b80915050919050565b6000610b7d610b7884611331565b61130c565b905082815260208101848484011115610b9957610b986115c8565b5b610ba48482856114d8565b509392505050565b600081359050610bbb81611750565b92915050565b600081519050610bd081611767565b92915050565b600081359050610be58161177e565b92915050565b600082601f830112610c0057610bff6115a5565b5b8135610c10848260208601610b6a565b91505092915050565b600081359050610c2881611795565b92915050565b60006101808284031215610c4557610c446115af565b5b81905092915050565b60006101808284031215610c6557610c646115b4565b5b610c7061018061130c565b90506000610c8084828501610bac565b6000830152506020610c9484828501610dc4565b602083015250604082013567ffffffffffffffff811115610cb857610cb76115be565b5b610cc484828501610beb565b604083015250606082013567ffffffffffffffff811115610ce857610ce76115be565b5b610cf484828501610beb565b6060830152506080610d0884828501610dee565b60808301525060a0610d1c84828501610dc4565b60a08301525060c0610d3084828501610dee565b60c08301525060e0610d4484828501610dee565b60e083015250610100610d5984828501610bac565b61010083015250610120610d6f84828501610bd6565b61012083015250610140610d8584828501610bac565b6101408301525061016082013567ffffffffffffffff811115610dab57610daa6115be565b5b610db784828501610beb565b6101608301525092915050565b600081359050610dd3816117a5565b92915050565b600081519050610de8816117a5565b92915050565b600081359050610dfd816117bc565b92915050565b600060208284031215610e1957610e186115d2565b5b6000610e2784828501610bac565b91505092915050565b60008060408385031215610e4757610e466115d2565b5b6000610e5585828601610bac565b9250506020610e6685828601610dc4565b9150509250929050565b600060208284031215610e8657610e856115d2565b5b6000610e9484828501610bc1565b91505092915050565b600060208284031215610eb357610eb26115d2565b5b6000610ec184828501610bd6565b91505092915050565b60008060008060808587031215610ee457610ee36115d2565b5b6000610ef287828801610c19565b945050602085013567ffffffffffffffff811115610f1357610f126115cd565b5b610f1f87828801610c2e565b9350506040610f3087828801610bd6565b9250506060610f4187828801610dc4565b91505092959194509250565b600060208284031215610f6357610f626115d2565b5b600082013567ffffffffffffffff811115610f8157610f806115cd565b5b610f8d84828501610c2e565b91505092915050565b600060208284031215610fac57610fab6115d2565b5b6000610fba84828501610dd9565b91505092915050565b610fcc8161145f565b82525050565b610fdb81611471565b82525050565b610fea8161147d565b82525050565b6000610ffc8385611362565b93506110098385846114d8565b82840190509392505050565b600061102260268361136d565b915061102d826115e8565b604082019050919050565b6000611045601c8361136d565b915061105082611637565b602082019050919050565b6000611068602a8361136d565b915061107382611660565b604082019050919050565b600061108b60208361136d565b9150611096826116af565b602082019050919050565b60006110ae60278361136d565b91506110b9826116d8565b604082019050919050565b60006110d1601a8361136d565b91506110dc82611727565b602082019050919050565b6110f0816114a7565b82525050565b6000611103828486610ff0565b91508190509392505050565b60006020820190506111246000830184610fc3565b92915050565b600060408201905061113f6000830185610fc3565b61114c6020830184610fc3565b9392505050565b60006060820190506111686000830186610fc3565b6111756020830185610fc3565b61118260408301846110e7565b949350505050565b600060408201905061119f6000830185610fc3565b6111ac60208301846110e7565b9392505050565b60006020820190506111c86000830184610fd2565b92915050565b60006020820190506111e36000830184610fe1565b92915050565b6000602082019050818103600083015261120281611015565b9050919050565b6000602082019050818103600083015261122281611038565b9050919050565b600060208201905081810360008301526112428161105b565b9050919050565b600060208201905081810360008301526112628161107e565b9050919050565b60006020820190508181036000830152611282816110a1565b9050919050565b600060208201905081810360008301526112a2816110c4565b9050919050565b600080833560016020038436030381126112c6576112c56115b9565b5b80840192508235915067ffffffffffffffff8211156112e8576112e76115aa565b5b602083019250600182023603831315611304576113036115c3565b5b509250929050565b6000611316611327565b905061132282826114e7565b919050565b6000604051905090565b600067ffffffffffffffff82111561134c5761134b611576565b5b611355826115d7565b9050602081019050919050565b600081905092915050565b600082825260208201905092915050565b6000611389826114a7565b9150611394836114a7565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff038211156113c9576113c8611518565b5b828201905092915050565b60006113df826114a7565b91506113ea836114a7565b9250826113fa576113f9611547565b5b828204905092915050565b6000611410826114a7565b915061141b836114a7565b9250817fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff048311821515161561145457611453611518565b5b828202905092915050565b600061146a82611487565b9050919050565b60008115159050919050565b6000819050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b600067ffffffffffffffff82169050919050565b60006114d13683610c4e565b9050919050565b82818337600083830152505050565b6114f0826115d7565b810181811067ffffffffffffffff8211171561150f5761150e611576565b5b80604052505050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f4f776e61626c653a206e6577206f776e657220697320746865207a65726f206160008201527f6464726573730000000000000000000000000000000000000000000000000000602082015250565b7f546f6b656e5061796d61737465723a206e6f20616c6c6f77616e636500000000600082015250565b7f546f6b656e5061796d61737465723a20756e6b6e6f776e2077616c6c6574206360008201527f6f6e7374727563746f7200000000000000000000000000000000000000000000602082015250565b7f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e6572600082015250565b7f546f6b656e5061796d61737465723a206e6f2062616c616e636520287072652d60008201527f6372656174652900000000000000000000000000000000000000000000000000602082015250565b7f546f6b656e5061796d61737465723a206e6f2062616c616e6365000000000000600082015250565b6117598161145f565b811461176457600080fd5b50565b61177081611471565b811461177b57600080fd5b50565b6117878161147d565b811461179257600080fd5b50565b600381106117a257600080fd5b50565b6117ae816114a7565b81146117b957600080fd5b50565b6117c5816114b1565b81146117d057600080fd5b5056fea26469706673582212200b754e44d488c67dc613d722cbdaa42b4afafcf9385682666259d991dccd0d4a64736f6c63430008070033608060405234801561001057600080fd5b5061215d806100206000396000f3fe6080604052600436106100a05760003560e01c8063b62654fb11610064578063b62654fb1461017d578063be6002c2146101a8578063c02a6bd5146101d1578063d45109f4146101fa578063d68a7a6d14610223578063f09a40161461024c576100a7565b806306552ff3146100ac57806341ed0e59146100d55780638da5cb5b146100fe578063a9059cbb14610129578063affed0e014610152576100a7565b366100a757005b600080fd5b3480156100b857600080fd5b506100d360048036038101906100ce9190611380565b610275565b005b3480156100e157600080fd5b506100fc60048036038101906100f79190611280565b610333565b005b34801561010a57600080fd5b506101136103da565b60405161012091906117ca565b60405180910390f35b34801561013557600080fd5b50610150600480360381019061014b91906112ad565b610400565b005b34801561015e57600080fd5b50610167610453565b6040516101749190611a66565b60405180910390f35b34801561018957600080fd5b50610192610459565b60405161019f91906117ca565b60405180910390f35b3480156101b457600080fd5b506101cf60048036038101906101ca91906113e7565b61047f565b005b3480156101dd57600080fd5b506101f860048036038101906101f391906112ed565b610506565b005b34801561020657600080fd5b50610221600480360381019061021c91906114b4565b610624565b005b34801561022f57600080fd5b5061024a60048036038101906102459190611501565b6106fc565b005b34801561025857600080fd5b50610273600480360381019061026e9190611340565b610885565b005b61027f8484610885565b8173ffffffffffffffffffffffffffffffffffffffff1663095ea7b3827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff6040518363ffffffff1660e01b81526004016102da92919061180e565b602060405180830381600087803b1580156102f457600080fd5b505af1158015610308573d6000803e3d6000fd5b505050506040513d601f19601f8201168201806040525081019061032c9190611447565b5050505050565b61033b610a0c565b7fbf7405b81de3cf3dde24b3ee97cd49371cee922e21a8a7960dfe8e31a0ef9425600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff168260405161038e9291906117e5565b60405180910390a180600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555050565b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b610408610a0c565b8173ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f1935050505015801561044e573d6000803e3d6000fd5b505050565b60005481565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1681565b610487610a0c565b60008373ffffffffffffffffffffffffffffffffffffffff1683836040516104b092919061178b565b6000604051808303816000865af19150503d80600081146104ed576040519150601f19603f3d011682016040523d82523d6000602084013e6104f2565b606091505b505090508061050057600080fd5b50505050565b600073ffffffffffffffffffffffffffffffffffffffff16600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614610597576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161058e906119e6565b60405180910390fd5b80600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055508273ffffffffffffffffffffffffffffffffffffffff166108fc839081150290604051600060405180830381858888f1935050505015801561061e573d6000803e3d6000fd5b50505050565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161461067e57600080fd5b60003073ffffffffffffffffffffffffffffffffffffffff1683836040516106a792919061178b565b6000604051808303816000865af19150503d80600081146106e4576040519150601f19603f3d011682016040523d82523d6000602084013e6106e9565b606091505b50509050806106f757600080fd5b505050565b600073ffffffffffffffffffffffffffffffffffffffff16600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614806107a65750600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b6107e5576040517f08c379a00000000000000000000000000000000000000000000000000000000081526004016107dc906119a6565b60405180910390fd5b6107ee81610af6565b6107f781610d8c565b600061080282610dea565b905060008114610881573373ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050610880576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161087790611a26565b60405180910390fd5b5b5050565b600073ffffffffffffffffffffffffffffffffffffffff16600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1614610916576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161090d90611a46565b60405180910390fd5b600073ffffffffffffffffffffffffffffffffffffffff168273ffffffffffffffffffffffffffffffffffffffff161415610986576040517f08c379a000000000000000000000000000000000000000000000000000000000815260040161097d90611946565b60405180910390fd5b81600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555080600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505050565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161480610ab55750600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16145b610af4576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610aeb90611986565b60405180910390fd5b565b600073ffffffffffffffffffffffffffffffffffffffff16600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff161480610bb3575080610140016020810190610b629190611280565b73ffffffffffffffffffffffffffffffffffffffff16600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16145b610bf2576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610be990611a06565b60405180910390fd5b6000610c0682610c0190611cc4565b610e26565b9050604182806101600190610c1b9190611a81565b905014610c5d576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610c5490611926565b60405180910390fd5b60008083806101600190610c719190611a81565b810190610c7e9190611474565b91509150600084806101600190610c959190611a81565b6040818110610ca757610ca6611dcc565b5b9050013560f81c60f81b60f81c905060018482858560405160008152602001604052604051610cd994939291906118e1565b6020604051602081039080840390855afa158015610cfb573d6000803e3d6000fd5b5050506020604051035173ffffffffffffffffffffffffffffffffffffffff1685610140016020810190610d2f9190611280565b73ffffffffffffffffffffffffffffffffffffffff1614610d85576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610d7c90611966565b60405180910390fd5b5050505050565b8060200135600080815480929190610da390611d4a565b9190505514610de7576040517f08c379a0000000000000000000000000000000000000000000000000000000008152600401610dde906119c6565b60405180910390fd5b50565b6000610dfe82610df990611cc4565b610e65565b15610e0c5760009050610e21565b610e1e82610e1990611cc4565b610ea3565b90505b919050565b6000610e3182610ece565b80519060200120604051602001610e4891906117a4565b604051602081830303815290604052805190602001209050919050565b60008073ffffffffffffffffffffffffffffffffffffffff1682610100015173ffffffffffffffffffffffffffffffffffffffff1614159050919050565b60008160c0015167ffffffffffffffff16610ebd83610f33565b610ec79190611bd3565b9050919050565b6060816000015182602001518360400151846060015185608001518660a001518760c001518860e001518961010001518a6101200151604051602001610f1d9a99989796959493929190611837565b6040516020818303038152906040529050919050565b600080826080015167ffffffffffffffff16905060008360400151511115610f8857600083606001515160c8610f699190611bd3565b617d00610f769190611b7d565b90508082610f849190611b7d565b9150505b80915050919050565b6000610fa4610f9f84611b09565b611ae4565b905082815260208101848484011115610fc057610fbf611e57565b5b610fcb848285611cd7565b509392505050565b600081359050610fe281612086565b92915050565b600081359050610ff78161209d565b92915050565b60008151905061100c816120b4565b92915050565b600081359050611021816120cb565b92915050565b60008083601f84011261103d5761103c611e2f565b5b8235905067ffffffffffffffff81111561105a57611059611e2a565b5b60208301915083600182028301111561107657611075611e4d565b5b9250929050565b600082601f83011261109257611091611e2f565b5b81356110a2848260208601610f91565b91505092915050565b6000813590506110ba816120e2565b92915050565b600061018082840312156110d7576110d6611e39565b5b81905092915050565b600061018082840312156110f7576110f6611e3e565b5b611102610180611ae4565b9050600061111284828501610fd3565b600083015250602061112684828501611256565b602083015250604082013567ffffffffffffffff81111561114a57611149611e48565b5b6111568482850161107d565b604083015250606082013567ffffffffffffffff81111561117a57611179611e48565b5b6111868482850161107d565b606083015250608061119a8482850161126b565b60808301525060a06111ae84828501611256565b60a08301525060c06111c28482850161126b565b60c08301525060e06111d68482850161126b565b60e0830152506101006111eb84828501610fd3565b6101008301525061012061120184828501611012565b6101208301525061014061121784828501610fd3565b6101408301525061016082013567ffffffffffffffff81111561123d5761123c611e48565b5b6112498482850161107d565b6101608301525092915050565b600081359050611265816120f9565b92915050565b60008135905061127a81612110565b92915050565b60006020828403121561129657611295611e61565b5b60006112a484828501610fd3565b91505092915050565b600080604083850312156112c4576112c3611e61565b5b60006112d285828601610fe8565b92505060206112e385828601611256565b9150509250929050565b60008060006060848603121561130657611305611e61565b5b600061131486828701610fe8565b935050602061132586828701611256565b925050604061133686828701610fd3565b9150509250925092565b6000806040838503121561135757611356611e61565b5b600061136585828601610fd3565b925050602061137685828601610fd3565b9150509250929050565b6000806000806080858703121561139a57611399611e61565b5b60006113a887828801610fd3565b94505060206113b987828801610fd3565b93505060406113ca878288016110ab565b92505060606113db87828801610fd3565b91505092959194509250565b600080600060408486031215611400576113ff611e61565b5b600061140e86828701610fd3565b935050602084013567ffffffffffffffff81111561142f5761142e611e5c565b5b61143b86828701611027565b92509250509250925092565b60006020828403121561145d5761145c611e61565b5b600061146b84828501610ffd565b91505092915050565b6000806040838503121561148b5761148a611e61565b5b600061149985828601611012565b92505060206114aa85828601611012565b9150509250929050565b600080602083850312156114cb576114ca611e61565b5b600083013567ffffffffffffffff8111156114e9576114e8611e5c565b5b6114f585828601611027565b92509250509250929050565b60006020828403121561151757611516611e61565b5b600082013567ffffffffffffffff81111561153557611534611e5c565b5b611541848285016110c0565b91505092915050565b61155381611c2d565b82525050565b61156281611c5d565b82525050565b61157961157482611c5d565b611d93565b82525050565b600061158b8385611b56565b9350611598838584611cd7565b82840190509392505050565b60006115af82611b3a565b6115b98185611b45565b93506115c9818560208601611ce6565b6115d281611e66565b840191505092915050565b60006115ea601c83611b72565b91506115f582611e77565b601c82019050919050565b600061160d602083611b61565b915061161882611ea0565b602082019050919050565b6000611630602283611b61565b915061163b82611ec9565b604082019050919050565b6000611653601783611b61565b915061165e82611f18565b602082019050919050565b6000611676602783611b61565b915061168182611f41565b604082019050919050565b6000611699601a83611b61565b91506116a482611f90565b602082019050919050565b60006116bc601583611b61565b91506116c782611fb9565b602082019050919050565b60006116df601583611b61565b91506116ea82611fe2565b602082019050919050565b6000611702601183611b61565b915061170d8261200b565b602082019050919050565b6000611725601083611b61565b915061173082612034565b602082019050919050565b6000611748601b83611b61565b91506117538261205d565b602082019050919050565b61176781611c99565b82525050565b61177681611ca3565b82525050565b61178581611cb7565b82525050565b600061179882848661157f565b91508190509392505050565b60006117af826115dd565b91506117bb8284611568565b60208201915081905092915050565b60006020820190506117df600083018461154a565b92915050565b60006040820190506117fa600083018561154a565b611807602083018461154a565b9392505050565b6000604082019050611823600083018561154a565b611830602083018461175e565b9392505050565b60006101408201905061184d600083018d61154a565b61185a602083018c61175e565b818103604083015261186c818b6115a4565b90508181036060830152611880818a6115a4565b905061188f608083018961176d565b61189c60a083018861175e565b6118a960c083018761176d565b6118b660e083018661176d565b6118c461010083018561154a565b6118d2610120830184611559565b9b9a5050505050505050505050565b60006080820190506118f66000830187611559565b611903602083018661177c565b6119106040830185611559565b61191d6060830184611559565b95945050505050565b6000602082019050818103600083015261193f81611600565b9050919050565b6000602082019050818103600083015261195f81611623565b9050919050565b6000602082019050818103600083015261197f81611646565b9050919050565b6000602082019050818103600083015261199f81611669565b9050919050565b600060208201905081810360008301526119bf8161168c565b9050919050565b600060208201905081810360008301526119df816116af565b9050919050565b600060208201905081810360008301526119ff816116d2565b9050919050565b60006020820190508181036000830152611a1f816116f5565b9050919050565b60006020820190508181036000830152611a3f81611718565b9050919050565b60006020820190508181036000830152611a5f8161173b565b9050919050565b6000602082019050611a7b600083018461175e565b92915050565b60008083356001602003843603038112611a9e57611a9d611e43565b5b80840192508235915067ffffffffffffffff821115611ac057611abf611e34565b5b602083019250600182023603831315611adc57611adb611e52565b5b509250929050565b6000611aee611aff565b9050611afa8282611d19565b919050565b6000604051905090565b600067ffffffffffffffff821115611b2457611b23611dfb565b5b611b2d82611e66565b9050602081019050919050565b600081519050919050565b600082825260208201905092915050565b600081905092915050565b600082825260208201905092915050565b600081905092915050565b6000611b8882611c99565b9150611b9383611c99565b9250827fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff03821115611bc857611bc7611d9d565b5b828201905092915050565b6000611bde82611c99565b9150611be983611c99565b9250817fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff0483118215151615611c2257611c21611d9d565b5b828202905092915050565b6000611c3882611c79565b9050919050565b6000611c4a82611c79565b9050919050565b60008115159050919050565b6000819050919050565b6000611c7282611c2d565b9050919050565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b6000819050919050565b600067ffffffffffffffff82169050919050565b600060ff82169050919050565b6000611cd036836110e0565b9050919050565b82818337600083830152505050565b60005b83811015611d04578082015181840152602081019050611ce9565b83811115611d13576000848401525b50505050565b611d2282611e66565b810181811067ffffffffffffffff82111715611d4157611d40611dfb565b5b80604052505050565b6000611d5582611c99565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff821415611d8857611d87611d9d565b5b600182019050919050565b6000819050919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052603260045260246000fd5b7f4e487b7100000000000000000000000000000000000000000000000000000000600052604160045260246000fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b600080fd5b6000601f19601f8301169050919050565b7f19457468657265756d205369676e6564204d6573736167653a0a333200000000600082015250565b7f77616c6c65743a20696e76616c6964207369676e6174757265206c656e677468600082015250565b7f77616c6c65743a2063616e6e6f742068617665206e756c6c2073696e676c657460008201527f6f6e000000000000000000000000000000000000000000000000000000000000602082015250565b7f77616c6c65743a2077726f6e67207369676e6174757265000000000000000000600082015250565b7f77616c6c65743a206f6e6c79207468726f7567682073696e676c65746f6e206f60008201527f72206f776e657200000000000000000000000000000000000000000000000000602082015250565b7f77616c6c65743a206e6f742066726f6d2053696e676c65746f6e000000000000600082015250565b7f77616c6c65743a20696e76616c6964206e6f6e63650000000000000000000000600082015250565b7f73696e676c65746f6e20616c7265616479207365740000000000000000000000600082015250565b7f77616c6c65743a206e6f74206f776e6572000000000000000000000000000000600082015250565b7f6661696c656420746f2070726570617900000000000000000000000000000000600082015250565b7f77616c6c65743a20616c726561647920696e697469616c697a65640000000000600082015250565b61208f81611c2d565b811461209a57600080fd5b50565b6120a681611c3f565b81146120b157600080fd5b50565b6120bd81611c51565b81146120c857600080fd5b50565b6120d481611c5d565b81146120df57600080fd5b50565b6120eb81611c67565b81146120f657600080fd5b50565b61210281611c99565b811461210d57600080fd5b50565b61211981611ca3565b811461212457600080fd5b5056fea264697066735822122038502fcc6d8598f22f417d7dd313b66c2dce1530249b35ee665895822818dcbc64736f6c63430008070033";
            
            public static long LargeGasLimit = 2_000_000;
            
            private static PrivateKey ContractCreatorPrivateKey = TestItem.PrivateKeyC;

            public static async Task<(Address, Address?, Address?)> Deploy(TestAccountAbstractionRpcBlockchain chain, string? walletCode = null, string? paymasterCode = null)
            {
                bool createWallet = walletCode is not null;
                bool createPaymaster = paymasterCode is not null;
                
                
                IList<Transaction> transactionsToInclude = new List<Transaction>();

                Transaction singletonTx = Core.Test.Builders.Build.A.Transaction.WithCode(Bytes.FromHexString(SingletonCode)).WithGasLimit(LargeGasLimit).WithNonce(0).WithValue(0).SignedAndResolved(ContractCreatorPrivateKey).TestObject;
                transactionsToInclude.Add(singletonTx);
                
                Transaction? walletTx = createWallet ? Core.Test.Builders.Build.A.Transaction.WithCode(Bytes.FromHexString(walletCode)).WithGasLimit(LargeGasLimit).WithNonce(1).WithValue(0).SignedAndResolved(ContractCreatorPrivateKey).TestObject : null;
                if (createWallet) transactionsToInclude.Add(walletTx!);
                
                Transaction? paymasterTx = createPaymaster ? Core.Test.Builders.Build.A.Transaction.WithCode(Bytes.FromHexString(paymasterCode)).WithGasLimit(LargeGasLimit).WithNonce(2).WithValue(0).SignedAndResolved(ContractCreatorPrivateKey).TestObject : null;
                if (createPaymaster) transactionsToInclude.Add(paymasterTx!);
                
                await chain.AddBlock(true, transactionsToInclude.ToArray());

                TxReceipt createSingletonTxReceipt = chain.Bridge.GetReceipt(singletonTx.Hash!);
                TxReceipt? createWalletTxReceipt = createWallet ? chain.Bridge.GetReceipt(walletTx.Hash!) : null;
                TxReceipt? createPaymasterTxReceipt = createPaymaster ? chain.Bridge.GetReceipt(paymasterTx.Hash!) : null;
                createSingletonTxReceipt.ContractAddress.Should().NotBeNull($"Contract transaction {singletonTx.Hash!} was not deployed.");
                createWalletTxReceipt?.ContractAddress.Should().NotBeNull($"Contract transaction {walletTx?.Hash!} was not deployed.");
                createPaymasterTxReceipt?.ContractAddress.Should().NotBeNull($"Contract transaction {paymasterTx?.Hash!} was not deployed.");
                
                return (createSingletonTxReceipt.ContractAddress!, createWalletTxReceipt?.ContractAddress!, createPaymasterTxReceipt?.ContractAddress!);
            }
        }

        [Test]
        public async Task Should_deploy_contracts_successfully()
        {
            var chain = await CreateChain();
            (Address singletonAddress, Address? walletAddress, Address? paymasterAddress) = await Contracts.Deploy(chain, Contracts.SimpleWalletCode, Contracts.SimplePaymasterCode);
        }
        
        [Test]
        public async Task Should_execute_well_formed_op_successfully()
        {
            var chain = await CreateChain();
            (Address singletonAddress, Address? walletAddress, Address? paymasterAddress) = await Contracts.Deploy(chain, Contracts.SimpleWalletCode, Contracts.SimplePaymasterCode);

            PrivateKey privateKey = new PrivateKey("0x1111111111111111111111111111111111111111111111111111111111111111");
            
            
            UserOperation op = new UserOperation(
                new Address("0x59b670e9fA9D0A427751Af201D676719a970857b"), 
                0, 
                Bytes.FromHexString("0xbe6002c20000000000000000000000007a2088a1bfc9d81c55368ae168c2c02570cb814f0000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000000406661abd00000000000000000000000000000000000000000000000000000000"), 
                Bytes.Empty,
                107950, 
                500000,
                1020158993, 
                22995721, 
                Address.Zero, 
                privateKey.Address, 
                new Signature(0, 1, 1000), 
                new AccessList(new Dictionary<Address, IReadOnlySet<UInt256>>()));

            UserOperation op1 = SignUserOperation(op, privateKey);
            
            chain.SendUserOperation(op1);
            
            await chain.AddBlock(true);
        }

        public static UserOperation SignUserOperation(UserOperation op, PrivateKey privateKey)
        {
            List<byte[]> bytesList = new List<byte[]>();
            bool packed = true;
            
            bytesList.Add(AbiAddress.Instance.Encode(op.Target, packed));
            bytesList.Add(AbiType.UInt256.Encode(op.Nonce, packed));
            bytesList.Add(AbiType.DynamicBytes.Encode(op.InitCode, packed));
            bytesList.Add(AbiType.DynamicBytes.Encode(op.CallData, packed));
            bytesList.Add(new AbiUInt(64).Encode((ulong)op.CallGas, packed));
            bytesList.Add(new AbiUInt(64).Encode((ulong)op.VerificationGas, packed));
            bytesList.Add(AbiType.UInt256.Encode(op.MaxFeePerGas, packed));
            bytesList.Add(AbiType.UInt256.Encode(op.MaxPriorityFeePerGas, packed));
            bytesList.Add(AbiAddress.Instance.Encode(op.Paymaster, packed));
            bytesList.Add(Bytes.Zero32);

            Keccak abiMessage = Keccak.Compute(Bytes.Concat(bytesList.ToArray()));

            Signer signer = new(1, privateKey, NullLogManager.Instance);
            Signature signature = signer.Sign(Keccak.Compute(
                    Bytes.Concat(
                        Encoding.UTF8.GetBytes("\x19"),
                        Encoding.UTF8.GetBytes("Ethereum Signed Message:\n" + abiMessage.Bytes.Length),
                        abiMessage.Bytes)
                    )
                );

            UserOperation newOp = new(
                op.Target, 
                op.Nonce, 
                op.CallData, 
                op.InitCode, 
                op.CallGas,
                op.VerificationGas, 
                op.MaxFeePerGas, 
                op.MaxPriorityFeePerGas, 
                op.Paymaster, 
                op.Signer, 
                signature,
                op.AccessList);

            return newOp;
        }
    }
}
